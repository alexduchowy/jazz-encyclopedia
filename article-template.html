<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Article</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        .gradient-text {
            background: -webkit-linear-gradient(45deg, #4f46e5, #c026d3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Style for the main content body injected from the database */
        #article-body p {
            margin-bottom: 1.5rem;
            line-height: 1.75;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Main Container -->
    <div id="article-container" class="container mx-auto px-4 py-8 sm:px-6 lg:px-8 hidden">
        
        <article class="max-w-4xl mx-auto">
            
            <!-- Header Section -->
            <header class="text-center mb-8">
                <p id="article-category" class="text-indigo-600 font-semibold tracking-wide uppercase">News</p>
                <h1 id="article-title" class="text-4xl md:text-6xl font-extrabold tracking-tight text-gray-900 mt-2">
                    <!-- Title will be injected here -->
                </h1>
                <p id="article-meta" class="mt-4 text-lg text-gray-600">
                    <!-- Author and Date will be injected here -->
                </p>
            </header>

            <!-- Main Image -->
            <figure class="mb-8">
                <img id="article-image" src="https://placehold.co/1200x600/cccccc/ffffff?text=Loading+Image..." 
                     alt="Article main image" 
                     class="w-full h-auto object-cover rounded-lg shadow-lg">
            </figure>

            <!-- Introduction -->
            <div id="article-body" class="prose prose-lg max-w-none mb-12 text-lg leading-8 text-gray-800">
                <!-- Body content will be injected here -->
            </div>
            
            <!-- Back Button -->
            <div class="text-center mt-12">
                 <a href="admin.html" class="inline-block bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors">
                    &larr; Back to Admin Dashboard
                </a>
            </div>

        </article>
        
        <!-- Footer -->
        <footer class="text-center mt-12 pt-8 border-t border-gray-200">
            <p class="text-gray-500">&copy; 2025 Your News Publication. All Rights Reserved.</p>
        </footer>

    </div>
    
    <!-- Loading / Not Found State -->
    <div id="status-message" class="text-center py-20">
        <h2 class="text-2xl font-bold">Loading article...</h2>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const ArticleViewer = {
            db: null,
            elements: {},

            init() {
                this.cacheDOMElements();
                this.setupFirebase();
                this.loadArticle();
            },

            cacheDOMElements() {
                this.elements = {
                    container: document.getElementById('article-container'),
                    title: document.getElementById('article-title'),
                    category: document.getElementById('article-category'),
                    meta: document.getElementById('article-meta'),
                    image: document.getElementById('article-image'),
                    body: document.getElementById('article-body'),
                    statusMessage: document.getElementById('status-message'),
                };
            },

            setupFirebase() {
                try {
                    // IMPORTANT: Replace with your actual Firebase config
                    const firebaseConfig = {
                      apiKey: "AIzaSyA1ZujlHARbBmqjr8Hi_GETCk4UzD_J4hM",
                      authDomain: "controlled-freedom.firebaseapp.com",
                      projectId: "controlled-freedom",
                      storageBucket: "controlled-freedom.appspot.com",
                      messagingSenderId: "992659637634",
                      appId: "1:992659637634:web:88de99efae5cb7cf53bb9b",
                      measurementId: "G-ETT07JGVSB"
                    };

                    const app = initializeApp(firebaseConfig);
                    this.db = getFirestore(app);
                } catch (error) {
                    console.error("Firebase initialization error:", error);
                    this.elements.statusMessage.innerHTML = `<h2 class="text-2xl font-bold text-red-600">Error initializing page. Check console.</h2>`;
                }
            },

            async loadArticle() {
                const params = new URLSearchParams(window.location.search);
                const articleId = params.get('id');

                if (!articleId) {
                    this.elements.statusMessage.innerHTML = `<h2 class="text-2xl font-bold text-red-500">No article ID provided.</h2><p class="mt-2">Please go back to the admin panel and click "View" on an article.</p>`;
                    return;
                }

                try {
                    const docRef = doc(this.db, "articles", articleId);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        this.renderArticle(docSnap.data());
                    } else {
                        this.elements.statusMessage.innerHTML = `<h2 class="text-2xl font-bold text-red-500">Article not found.</h2><p class="mt-2">The requested article does not exist or may have been deleted.</p>`;
                    }
                } catch (error) {
                    console.error("Error fetching article:", error);
                    this.elements.statusMessage.innerHTML = `<h2 class="text-2xl font-bold text-red-500">Error loading article.</h2><p class="mt-2">Could not fetch data from the database. See console for details.</p>`;
                }
            },

            renderArticle(data) {
                document.title = data.title; // Set the page title
                this.elements.title.textContent = data.title;
                this.elements.category.textContent = data.type;
                this.elements.meta.textContent = `By ${data.author} on ${data.publishDate}`;
                this.elements.image.src = data.imageUrl || 'https://placehold.co/1200x600/dddddd/333333?text=No+Image+Provided';
                this.elements.image.alt = data.title;
                
                // Sanitize and render HTML content for the body
                this.elements.body.innerHTML = data.body;

                this.elements.statusMessage.classList.add('hidden');
                this.elements.container.classList.remove('hidden');
            }
        };

        ArticleViewer.init();
    </script>
</body>
</html>

