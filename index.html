<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlled Freedom: An Interactive History of Post-Bop</title>
    
    <!-- External Libraries & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;700;900&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    
    <!-- Custom CSS Styling -->
    <style>
        /* Define custom color properties for easy theme management */
        :root {
            --bg-main: #f5f5f4; /* stone-100 */
            --bg-secondary: #e7e5e4; /* stone-200 */
            --bg-dark: #1a1a1a; /* Custom dark gray */
            --text-main: #1c1917; /* stone-900 */
            --text-muted: #57534e; /* stone-600 */
            --accent: #f97316; /* orange-500 */
            --accent-dark: #ea580c; /* orange-600 */

            /* Genre Colors */
            --genre-hard-bop: #d8b4fe; /* purple-300 */
            --genre-cool-jazz: #93c5fd; /* blue-300 */
            --genre-modal-jazz: #a7f3d0; /* emerald-200 */
            --genre-post-bop: #fed7aa; /* orange-200 */
            --genre-default: #e7e5e4; /* stone-200 */
        }

        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
        }
        
        /* Heading font styling with new Bebas Neue font */
        h1, h2, h3, h4, h5 {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.05em;
        }

        /* Crooked Header Style */
        header {
            transform: rotate(-1.5deg);
            margin-top: 1rem;
            box-shadow: 5px 5px 0px var(--text-main);
            border: 2px solid var(--text-main);
            margin-bottom: -100px; /* Pulls subsequent content up */
            position: relative; /* Needed for z-index and negative margin to work correctly */
        }
        
        /* Adjust main content to account for header overlap */
        main {
            padding-top: 100px; /* Pushes content down to create space for overlapping header */
        }

        /* Navigation link transition effects */
        .nav-link {
            transition: color 0.2s;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.1em;
            font-size: 1.1rem;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--accent);
        }

        /* Section header styling */
        .section-header {
             transform: rotate(-1deg);
             display: inline-block;
             background-color: var(--accent);
             color: var(--bg-main);
             padding: 0.25rem 1rem;
             margin-bottom: 1rem;
        }

        /* Timeline year marker styling */
        .year-marker {
            transition: background-color 0.2s, color 0.2s;
            border: 2px solid var(--text-main);
        }
        .year-marker.active, .year-marker:hover {
            background-color: var(--text-main);
            color: var(--bg-main);
        }

        /* Style matrix table transitions */
        .matrix-table th, .matrix-table td {
            transition: background-color 0.2s;
        }
        .matrix-table .highlight {
            background-color: var(--bg-secondary); 
        }

        /* Modal transition styles */
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
        
        /* Horizontal draggable timeline container */
        #horizontal-timeline-container {
            width: 100%;
            overflow-x: auto;
            cursor: grab;
            border: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #horizontal-timeline-container::-webkit-scrollbar {
            display: none;
        }
        #horizontal-timeline-container:active {
            cursor: grabbing;
        }
        /* Wrapper for all timeline content */
        #timeline-wrapper {
            display: inline-flex;
            align-items: flex-start;
            padding: 2rem 1rem;
        }
        /* Styling for each year's section in the timeline */
        .timeline-year-section {
            display: flex;
            flex-shrink: 0;
            flex-direction: column;
            align-items: flex-start;
            border-left: 4px dotted var(--bg-secondary);
            padding: 0 2rem;
        }
        .timeline-year-section:first-child {
            border-left: none;
        }
        /* Year header styling */
        .timeline-year-header {
            font-size: 3rem; 
            font-weight: 900;
            color: var(--text-main); 
            opacity: 0.15;
            margin-bottom: 1.5rem;
            width: 100%;
            text-align: left;
        }
        /* Grid for album cards within a year */
        .timeline-album-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
        }
        /* Individual album card styling */
        .timeline-album-card {
            width: 200px;
            flex-shrink: 0;
            background-color: var(--bg-main);
            border-radius: 0.25rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 4px 4px 0px var(--text-main);
            border: 2px solid var(--text-main);
            overflow: hidden;
        }
        .timeline-album-card:hover {
            transform: translateY(-5px) rotate(-2deg);
            box-shadow: 8px 8px 0px var(--accent);
        }
        .timeline-album-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }
        .timeline-album-card:hover img {
            filter: grayscale(0%);
        }
        .timeline-album-card-info {
            padding: 0.75rem;
        }
        .timeline-album-card-info h5 {
            color: var(--text-main);
            font-size: 1.25rem;
        }
        .timeline-album-card-info p {
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
        }
        /* Artist card styling */
        .artist-card {
            background-color: var(--bg-main);
            border-radius: 0.25rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 4px 4px 0px var(--text-main);
            border: 2px solid var(--text-main);
        }
        .artist-card:hover {
            transform: translateY(-5px) rotate(2deg);
            box-shadow: 8px 8px 0px var(--accent) !important; /* Ensure hover always wins */
        }
        .artist-card .artist-photo-container {
             height: 224px;
             width: 100%;
        }
        .artist-card img {
             width: 100%;
             height: 100%;
             object-fit: cover;
             object-position: center;
             filter: grayscale(100%);
             transition: filter 0.3s ease;
        }
         .artist-card:hover img {
            filter: grayscale(0%);
        }
        /* Artist Slider Styles */
        #artists-slider-container {
            width: 100%;
            overflow-x: auto;
            cursor: grab;
            -ms-overflow-style: none;
            scrollbar-width: none;
            scroll-behavior: smooth; /* For button scrolling */
        }
        #artists-slider-container::-webkit-scrollbar {
            display: none;
        }
        #artists-slider-container:active {
            cursor: grabbing;
        }
        #artists-slider-wrapper {
            display: flex;
        }
        .artist-page {
            width: 100%;
            flex-shrink: 0;
            padding: 1rem;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem; 
        }
        @media (min-width: 768px) {
            .artist-page {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        .styled-select select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f97316' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1.2em;
        }

        /* Modal Night Mode & Player Styles */
        #modal-analysis-section {
            background-color: var(--bg-dark);
            padding: 1.5rem;
            margin-top: 2rem;
            border: 2px solid var(--text-main);
            box-shadow: 4px 4px 0px var(--text-main);
        }
        #modal-analysis-section h5 {
            color: var(--bg-main);
        }
        
        .liner-notes-text {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            color: #d4d4d2; 
        }
        
        audio.styled-player {
            height: 35px; 
            accent-color: var(--accent);
        }

        /* Genre Filter Styling */
        #genre-filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .genre-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .genre-checkbox-label input {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--text-main);
            border-radius: 0.25rem;
            margin-right: 0.5rem;
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
        }
        .genre-checkbox-label input:checked {
            background-color: var(--accent);
            border-color: var(--accent-dark);
        }
        .genre-checkbox-label input:checked::after {
            content: '✔';
            position: absolute;
            color: var(--bg-main);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
        }

        /* Loading indicator styles */
        .loader {
            border: 4px solid var(--bg-secondary);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .genre-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
            border: 2px solid var(--text-main);
        }

    </style>
</head>
<body class="bg-stone-100 text-stone-900">

    <!-- Sticky Header Navigation -->
    <header class="bg-stone-100 sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <h1 class="text-3xl md:text-4xl font-bold text-stone-900 tracking-tight">Controlled Freedom</h1>
                <div class="hidden sm:flex sm:items-baseline sm:space-x-8">
                    <a href="#overview" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Overview</a>
                    <a href="#timeline" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Timeline</a>
                    <a href="#matrix" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Genres</a>
                    <a href="#artists" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Artists</a>
                    <a href="#legacy" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Legacy</a>
                </div>
                <div class="sm:hidden styled-select">
                    <select id="mobile-nav" class="block w-full rounded-sm border-2 border-stone-900 bg-stone-100 text-stone-900 py-2 pl-3 pr-10 focus:border-orange-500 focus:outline-none focus:ring-orange-500">
                        <option value="#overview">Overview</option>
                        <option value="#timeline">Timeline</option>
                        <option value="#matrix">Genres</option>
                        <option value="#artists">Artists</option>
                        <option value="#legacy">Legacy</option>
                    </select>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero Banner Section -->
        <section id="banner" class="w-full h-64 md:h-80 lg:h-96">
            <img src="images/banner.jpg" alt="Post-bop musicians in a rehearsal space" class="w-full h-full object-cover border-y-4 border-stone-900" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1511192336575-5a79af67d629?q=80&w=2074&auto=format&fit=crop';">
        </section>

        <!-- Overview Section -->
        <section id="overview" class="pt-4 pb-16 sm:pb-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl text-center">
                 <h2 class="section-header text-5xl">Post-Bop Encyclopedia</h2>
                <p class="text-center text-lg text-stone-600 mb-12 italic">An exploration into the era of "controlled freedom" that redefined jazz in the sixties.</p>
                <div class="space-y-6 text-base md:text-lg leading-relaxed text-stone-900 text-left">
                    <p>The term "post-bop" is a retrospective label for a musical methodology that flourished in the late 1950s and 1960s. It wasn't a genre with rigid rules, but a shared philosophy of <strong class="text-orange-500">"controlled freedom."</strong> Musicians of this era sought a middle ground between the structured harmony of hard bop and the radical abandon of free jazz. They aimed to expand the expressive possibilities of jazz by incorporating harmonic ambiguity and rhythmic complexity without completely discarding form and melody.</p>
                    <p>This application provides an interactive journey through this pivotal decade. You can explore a year-by-year timeline of landmark albums, compare the core tenets of post-bop against its contemporary styles, and visualize the contributions of its key architects. It's a tool designed to make the dense, interconnected history of this music accessible and engaging.</p>
                </div>
            </div>
        </section>

        <!-- Interactive Timeline Section -->
        <section id="timeline" class="py-16 sm:py-20 bg-stone-200 border-y-4 border-stone-900">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="section-header text-5xl">Timeline Explorer</h2>
                <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Drag or use the buttons to explore a year-by-year breakdown of landmark albums.</p>
                <div id="genre-filter-container"></div>
                <div class="flex items-center justify-center gap-4 mb-12">
                    <div id="timeline-nav" class="flex flex-wrap justify-center gap-2"></div>
                </div>
                <div class="relative group">
                    <div id="horizontal-timeline-container" class="min-h-[300px] flex items-center justify-center">
                        <div id="timeline-wrapper"></div>
                    </div>
                    <button id="scroll-left-btn" class="absolute left-0 sm:-left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    </button>
                    <button id="scroll-right-btn" class="absolute right-0 sm:-right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Genre Comparison Matrix Section -->
        <section id="matrix" class="py-16 sm:py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="section-header text-5xl">The Genres</h2>
                <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Hover over the matrix to see how post-bop differed from its stylistic neighbors.</p>
                <div class="overflow-x-auto border-2 border-stone-900 min-h-[300px]">
                    <table id="style-matrix-table" class="matrix-table w-full min-w-[800px] border-collapse text-left">
                        <thead>
                            <tr class="bg-stone-900 text-stone-100">
                                <th class="p-4 border-b-2 border-stone-900 font-bold text-2xl">Feature</th>
                                <th class="p-4 border-b-2 border-stone-900 font-bold text-2xl text-center">Hard Bop</th>
                                <th class="p-4 border-b-2 border-stone-900 font-bold text-2xl text-center">Modal Jazz</th>
                                <th class="p-4 border-b-2 border-stone-900 font-bold text-2xl text-center bg-orange-500 text-stone-900">Post-Bop</th>
                                <th class="p-4 border-b-2 border-stone-900 font-bold text-2xl text-center">Free Jazz</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Key Artists Slider Section -->
        <section id="artists" class="py-16 sm:py-20 bg-stone-200 border-y-4 border-stone-900">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                 <h2 class="section-header text-5xl">The Architects</h2>
                <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Explore the musicians who defined the post-bop era. Filter by instrument to begin.</p>
                
                <!-- Instrument Filter Dropdown -->
                <div class="flex justify-center mb-8">
                    <div class="w-full max-w-xs styled-select">
                        <label for="instrument-filter" class="block text-sm font-medium text-stone-600 mb-2 text-center">Filter by Instrument:</label>
                        <select id="instrument-filter" class="block w-full rounded-sm border-2 border-stone-900 bg-stone-100 text-stone-900 py-2 pl-3 pr-10 focus:border-orange-500 focus:outline-none focus:ring-orange-500 font-bold">
                        </select>
                    </div>
                </div>

                <div class="relative group">
                    <div id="artists-slider-container" class="min-h-[300px] flex items-center justify-center">
                        <div id="artists-slider-wrapper">
                            <!-- Artist pages will be injected here by JavaScript -->
                        </div>
                    </div>
                    <button id="artist-scroll-left-btn" class="absolute left-0 sm:-left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                    </button>
                    <button id="artist-scroll-right-btn" class="absolute right-0 sm:-right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Legacy Section -->
        <section id="legacy" class="py-16 sm:py-20">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl text-center">
                <h2 class="section-header text-5xl">Legacy</h2>
                <p class="text-center text-lg text-stone-600 mb-12 italic">How a golden age splintered into new forms, leaving an indelible mark on music.</p>
                <div class="space-y-6 text-base md:text-lg leading-relaxed text-stone-900 text-left">
                    <p>The golden age of acoustic innovation from 1958 to 1967 was a period of intense, shared creativity. However, by its end, the cohesive center of post-bop began to dissolve. The death of John Coltrane in 1967 removed a spiritual and musical lodestar. Simultaneously, Miles Davis began incorporating electric instruments and rock-influenced rhythms, paving the way for jazz-rock fusion with albums like *In a Silent Way* and *Bitches Brew*. This seismic shift created a new mainstream that would dominate the 1970s.</p>
                    <p>Yet, the legacy of post-bop is profound. Its harmonic, rhythmic, and compositional innovations became a permanent part of the modern jazz vocabulary. In the 1980s, the "Young Lions" movement, led by trumpeter Wynton Marsalis, sparked a "post-bop revival" that looked directly back to the acoustic, small-group aesthetic of the 1960s. This cemented the 1958-1967 period as a classic era, and its language remains the primary foundation for much of the acoustic jazz being played today.</p>
                </div>
                 <!-- Spotify Playlist -->
                 <div class="mt-16 text-left">
                     <h3 class="text-3xl text-stone-900 mb-4">Listen now on Spotify:</h3>
                     <iframe style="border-radius:0; border: 2px solid #1c1917;" src="https://open.spotify.com/embed/playlist/6JT7jtrtYO7d5FBC3Fhh0p?utm_source=generator&theme=0" width="100%" height="500" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                 </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-200 py-8">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="font-bold">An interactive exploration based on the "Chronological Encyclopedia of Post-Bop".</p>
            <p class="text-sm text-stone-400 mt-2">Designed to bring music history to life through interactive data visualization.</p>
        </div>
    </footer>

    <!-- Modals -->
    <div id="album-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div id="modal-content" class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                <div>
                    <h3 id="modal-title" class="text-4xl text-orange-500"></h3>
                    <p id="modal-artist" class="text-xl text-stone-600"></p>
                </div>
                <button id="close-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div id="modal-album-main-details" class="flex flex-col md:flex-row gap-6">
                    <div id="modal-album-art-container" class="w-full md:w-1/3 flex-shrink-0">
                         <img id="modal-album-art" src="" class="w-full h-auto rounded-sm border-2 border-stone-900" alt="">
                    </div>
                    <div id="modal-album-details" class="w-full md:w-2/3"></div>
                </div>
                <div id="analysis-wrapper" class="relative mt-4">
                    <!-- Content injected by JS -->
                </div>
            </div>
             <!-- NEW: Modal Navigation Footer -->
            <div id="modal-nav-footer" class="flex justify-between items-center p-4 border-t-2 border-stone-900 flex-shrink-0 bg-stone-200">
                <button id="prev-album-btn" class="px-4 py-2 bg-stone-900 text-stone-100 rounded-sm font-bold hover:bg-orange-500 transition-colors disabled:bg-stone-400 disabled:cursor-not-allowed">Previous Album</button>
                <button id="next-album-btn" class="px-4 py-2 bg-stone-900 text-stone-100 rounded-sm font-bold hover:bg-orange-500 transition-colors disabled:bg-stone-400 disabled:cursor-not-allowed">Next Album</button>
            </div>
        </div>
    </div>
    <div id="artist-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
             <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                <h3 id="artist-modal-title" class="text-4xl text-orange-500"></h3>
                <button id="close-artist-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">&times;</button>
            </div>
            <div id="artist-modal-body" class="p-6 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Show loading indicators while data is fetched.
            const timelineWrapper = document.getElementById('timeline-wrapper');
            const artistsSliderWrapper = document.getElementById('artists-slider-wrapper');
            timelineWrapper.innerHTML = '<div class="loader"></div>';
            artistsSliderWrapper.innerHTML = '<div class="loader"></div>';
            
            // Fetch data from the external database.html file.
            fetch('database.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(html => {
                    // Create a temporary DOM element to parse the fetched HTML.
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    // Extract the JSON data from the script tags.
                    const rawTrackDataEl = doc.getElementById('rawTrackData');
                    const styleMatrixDataEl = doc.getElementById('styleMatrixData');

                    if (!rawTrackDataEl || !styleMatrixDataEl) {
                        throw new Error('Data script tags not found in database.html');
                    }
                    
                    const rawTrackData = JSON.parse(rawTrackDataEl.textContent);
                    const styleMatrixData = JSON.parse(styleMatrixDataEl.textContent);
                    
                    // Initialize the application with the fetched data.
                    initializeAppUI(rawTrackData, styleMatrixData);
                })
                .catch(error => {
                    // If fetching fails, initialize with empty data for editing.
                    console.warn('Could not load database.html. Initializing with empty data.', error);
                    initializeAppUI([], []);
                });
        });

        function initializeAppUI(rawTrackData, styleMatrixData) {
            
            // Global state for album navigation
            let currentAlbumIndex = -1;
            let albums = [];
            
            const monthMap = { "January": 0, "February": 1, "March": 2, "April": 3, "May": 4, "June": 5, "July": 6, "August": 7, "September": 8, "October": 9, "November": 10, "December": 11 };
            
            function parseDate(dateString) {
                if (typeof dateString !== 'string') return null;
                if (dateString.startsWith('c.')) {
                    const year = parseInt(dateString.split(' ').pop());
                    return new Date(year, 11, 31);
                }
                const parts = dateString.replace(/,/g, '').split(' ');
                if (parts.length === 3 && monthMap.hasOwnProperty(parts[0])) return new Date(parts[2], monthMap[parts[0]], parts[1]);
                return null;
            }
            
            // Helper to format names for audio file paths
            const slugify = (name) => {
                if (!name) return '';
                return name.toLowerCase()
                    .replace(/\s+/g, '-') // Replace spaces with -
                    .replace(/[^\w-]+/g, '') // Remove all non-word chars
                    .replace(/--+/g, '-') // Replace multiple - with single -
                    .replace(/^-+/, '') // Trim - from start of text
                    .replace(/-+$/, ''); // Trim - from end of text
            }

            // Process raw track data into albums
            albums = rawTrackData.reduce((acc, track) => {
                let album = acc.find(a => a.albumTitle === track.album && a.artist === track.artist);
                if (!album) {
                    album = { 
                        year: track.year, 
                        artist: track.artist, 
                        albumTitle: track.album, 
                        cover: track.cover, 
                        pivotalTracks: [], 
                        genres: track.genre 
                    };
                    acc.push(album);
                }
                album.pivotalTracks.push(track);
                album.pivotalTracks.sort((a,b) => parseDate(a.recordingDate) - parseDate(b.recordingDate));
                return acc;
            }, []);
            
            // Set the first recording date for sorting purposes
            albums.forEach(album => {
                if (album.pivotalTracks.length > 0) {
                    album.firstRecordingDate = album.pivotalTracks[0].recordingDate;
                }
            });
            
            albums.sort((a,b) => parseDate(a.firstRecordingDate) - parseDate(b.firstRecordingDate));
            const years = [...new Set(albums.map(album => album.year))].sort();
            const groupedByYear = years.reduce((acc, year) => {
                acc[year] = albums.filter(d => d.year === year);
                return acc;
            }, {});

            const timelineNav = document.getElementById('timeline-nav');
            const timelineContainer = document.getElementById('horizontal-timeline-container');
            const timelineWrapper = document.getElementById('timeline-wrapper');
            const scrollLeftBtn = document.getElementById('scroll-left-btn');
            const scrollRightBtn = document.getElementById('scroll-right-btn');
            const genreFilterContainer = document.getElementById('genre-filter-container');
            
            const genres = {
                "Hard Bop": "var(--genre-hard-bop)",
                "Cool Jazz": "var(--genre-cool-jazz)",
                "Modal Jazz": "var(--genre-modal-jazz)",
                "Post-Bop": "var(--genre-post-bop)",
            };

            // Populate Genre Filters
            Object.keys(genres).forEach(genre => {
                const label = document.createElement('label');
                label.className = 'genre-checkbox-label';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = genre;
                checkbox.dataset.genre = genre;
                label.appendChild(checkbox);
                label.append(genre);
                genreFilterContainer.appendChild(label);
            });

            timelineWrapper.innerHTML = '';
            if (years.length > 0) {
                years.forEach(year => {
                    const yearSection = document.createElement('div');
                    yearSection.className = 'timeline-year-section';
                    yearSection.id = `year-${year}`;
                    const yearHeader = document.createElement('div');
                    yearHeader.className = 'timeline-year-header';
                    yearHeader.textContent = year;
                    yearSection.appendChild(yearHeader);
                    const albumList = document.createElement('div');
                    albumList.className = 'timeline-album-list';
                    groupedByYear[year].forEach(album => {
                        const card = document.createElement('div');
                        card.className = 'timeline-album-card';
                        card.dataset.albumTitle = album.albumTitle;
                        card.dataset.artist = album.artist;
                        card.dataset.genres = album.genres; // Add genres to dataset
                        card.innerHTML = `<img src="${album.cover || ''}" alt="Cover for ${album.albumTitle}" onerror="this.onerror=null;this.src='https://placehold.co/200x200/1c1917/f5f5f4?text=No+Image';"><div class="timeline-album-card-info"><h5 class="font-bold truncate">${album.albumTitle}</h5><p class="truncate">${album.artist}</p></div>`;
                        albumList.appendChild(card);
                    });
                    yearSection.appendChild(albumList);
                    timelineWrapper.appendChild(yearSection);
                });
                
                years.forEach(year => {
                    const yearButton = document.createElement('button');
                    yearButton.textContent = year;
                    yearButton.dataset.year = year;
                    yearButton.className = 'year-marker px-4 py-2 text-sm font-semibold rounded-sm bg-stone-100 text-stone-900';
                    yearButton.addEventListener('click', () => {
                        document.querySelectorAll('.year-marker').forEach(btn => btn.classList.remove('active'));
                        yearButton.classList.add('active');
                        const yearSection = document.getElementById(`year-${year}`);
                        if(yearSection) {
                            timelineContainer.scrollTo({ left: yearSection.offsetLeft - 32, behavior: 'smooth' });
                        }
                    });
                    timelineNav.appendChild(yearButton);
                });
                if (timelineNav.firstElementChild) timelineNav.firstElementChild.classList.add('active');
            } else {
                 timelineWrapper.innerHTML = '<p class="text-stone-500">No timeline data available.</p>';
            }

            // Genre Filter Logic
            genreFilterContainer.addEventListener('change', () => {
                const selectedGenres = Array.from(genreFilterContainer.querySelectorAll('input:checked')).map(input => input.value);
                
                document.querySelectorAll('.timeline-album-card').forEach(card => {
                    const cardGenres = card.dataset.genres.split(', ');
                    const isVisible = selectedGenres.length === 0 || cardGenres.some(genre => selectedGenres.includes(genre));
                    card.style.display = isVisible ? 'block' : 'none';
                });

                document.querySelectorAll('.timeline-year-section').forEach(yearSection => {
                    const visibleCards = yearSection.querySelectorAll('.timeline-album-card[style="display: block;"]');
                    yearSection.style.display = visibleCards.length > 0 ? 'flex' : 'none';
                });
            });

            const scrollAmount = 400;
            scrollLeftBtn.addEventListener('click', () => timelineContainer.scrollBy({ left: -scrollAmount, behavior: 'smooth' }));
            scrollRightBtn.addEventListener('click', () => timelineContainer.scrollBy({ left: scrollAmount, behavior: 'smooth' }));

            const albumModal = document.getElementById('album-modal');
            const albumModalContent = albumModal.querySelector('.modal-content');
            
            timelineWrapper.addEventListener('click', e => {
                const card = e.target.closest('.timeline-album-card');
                if (card) {
                    const { albumTitle, artist } = card.dataset;
                    const albumIndex = albums.findIndex(a => a.albumTitle === albumTitle && a.artist === artist);
                    if (albumIndex !== -1) {
                         openAlbumModal(albums[albumIndex], albumIndex);
                    }
                }
            });

            function openAlbumModal(album, index) {
                currentAlbumIndex = index;
                
                albumModal.querySelector('#modal-title').textContent = album.albumTitle;
                albumModal.querySelector('#modal-artist').textContent = album.artist;
                const modalImg = albumModal.querySelector('#modal-album-art');
                modalImg.src = album.cover || '';
                modalImg.alt = `Cover for ${album.albumTitle}`;
                modalImg.onerror = function() { this.onerror=null; this.src='https://placehold.co/400x400/1c1917/f5f5f4?text=No+Image'; };
                const firstTrack = album.pivotalTracks[0] || {};
                
                const genreTags = album.genres.split(', ').map(genre => {
                    const colorVar = genres[genre] || 'var(--genre-default)';
                    return `<span class="genre-tag" style="background-color: ${colorVar}">${genre}</span>`;
                }).join(' ');

                const detailsContainer = albumModal.querySelector('#modal-album-details');
                 detailsContainer.innerHTML = `
                      <h4 class="text-3xl text-stone-900 mb-4">Album Details</h4>
                      <div class="grid grid-cols-[auto,1fr] gap-x-4 gap-y-2 text-base text-stone-900">
                           <strong class="font-bold">Genre:</strong> <div class="flex flex-wrap gap-2">${genreTags}</div>
                           <strong class="font-bold">Recorded:</strong> <span>${firstTrack.recordingDate || 'N/A'}</span>
                           <strong class="font-bold">Label:</strong> <span>${firstTrack.label || 'N/A'}</span>
                           <strong class="font-bold">Line-Up:</strong> <span>${firstTrack.lineup || 'N/A'}</span>
                      </div>`;

                const analysisWrapper = albumModal.querySelector('#analysis-wrapper');
                analysisWrapper.innerHTML = ''; // Clear previous content
                
                const analysisContainer = document.createElement('div');
                analysisContainer.id = 'modal-analysis-section';
                
                const pivotalTracksHtml = album.pivotalTracks.map(track => {
                    const songFileName = slugify(track.title) + '.mp3';
                     return `
                          <div class="mb-8 last:mb-0">
                               <div class="flex justify-between items-center gap-4 mb-4 flex-wrap">
                                     <h5 class="text-2xl font-bold text-white flex-1 min-w-0">Key Track: "<span class="underline decoration-orange-500 decoration-2 underline-offset-4">${track.title}</span>"</h5>
                                    <audio controls class="styled-player w-full sm:w-52" src="songs/${songFileName}" preload="none"></audio>
                               </div>
                               <p class="liner-notes-text">${track.analysis}</p>
                          </div>
                     `;
                }).join('<hr class="border-stone-700 my-8">');

                analysisContainer.innerHTML = pivotalTracksHtml;
                analysisWrapper.appendChild(analysisContainer);
                
                // Add event listeners to ensure only one audio plays at a time
                const audioPlayers = analysisContainer.querySelectorAll('audio');
                audioPlayers.forEach(player => {
                    player.addEventListener('play', () => {
                        audioPlayers.forEach(otherPlayer => {
                            if (otherPlayer !== player) {
                                otherPlayer.pause();
                            }
                        });
                    });
                });

                // Update nav buttons
                const prevBtn = document.getElementById('prev-album-btn');
                const nextBtn = document.getElementById('next-album-btn');
                prevBtn.disabled = currentAlbumIndex === 0;
                nextBtn.disabled = currentAlbumIndex === albums.length - 1;

                albumModal.classList.remove('opacity-0', 'pointer-events-none');
                albumModalContent.classList.remove('scale-95');
                albumModal.querySelector('#modal-body').scrollTop = 0; // Scroll to top
            }
            
            function closeAlbumModal() {
                albumModal.classList.add('opacity-0', 'pointer-events-none');
                albumModalContent.classList.add('scale-95');
                // Stop all audio players when modal closes
                albumModal.querySelectorAll('audio').forEach(audio => audio.pause());
            }
            albumModal.querySelector('#close-modal').addEventListener('click', closeAlbumModal);
            albumModal.addEventListener('click', e => { if (e.target.id === 'album-modal') closeAlbumModal(); });

            // Set up modal navigation listeners
            document.getElementById('prev-album-btn').addEventListener('click', () => {
                if (currentAlbumIndex > 0) {
                    openAlbumModal(albums[currentAlbumIndex - 1], currentAlbumIndex - 1);
                }
            });
             document.getElementById('next-album-btn').addEventListener('click', () => {
                if (currentAlbumIndex < albums.length - 1) {
                    openAlbumModal(albums[currentAlbumIndex + 1], currentAlbumIndex + 1);
                }
            });


            // --- ARTISTS SECTION LOGIC ---
            const artistsSliderContainer = document.getElementById('artists-slider-container');
            const artistsSliderWrapper = document.getElementById('artists-slider-wrapper');
            const artistsData = processArtists(rawTrackData);
            const instrumentFilter = document.getElementById('instrument-filter');
            populateInstrumentFilter(artistsData);
            renderArtistSlider(artistsData);

            instrumentFilter.addEventListener('change', (e) => {
                const selectedInstrument = e.target.value;
                const filteredArtists = selectedInstrument === 'all'
                    ? artistsData
                    : artistsData.filter(artist => artist.instruments.includes(selectedInstrument));
                renderArtistSlider(filteredArtists);
            });
            
            function processArtists(tracks) {
                const artistsMap = new Map();
                const slugify = (name) => name ? name.toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]+/g, '') : '';
                
                tracks.forEach(track => {
                    const mainArtistString = track.artist;
                    if (!track.lineup) return;
                    const lineupParts = track.lineup.split(/,(?![^()]*\))/);

                    lineupParts.forEach(part => {
                        const match = part.trim().match(/(.+?)\s\((.+)\)/);
                        if (match) {
                            const name = match[1].trim();
                            const instrumentsString = match[2];
                            if (!artistsMap.has(name)) {
                                artistsMap.set(name, { 
                                    name: name, 
                                    instruments: new Set(), 
                                    albums: new Set(), 
                                    photo: `images/${slugify(name)}.jpg`,
                                    isBandleader: false,
                                    profile: ''
                                });
                            }
                            const artistEntry = artistsMap.get(name);
                            if (mainArtistString && mainArtistString.includes(name)) {
                                artistEntry.isBandleader = true;
                                switch(name) {
                                     case "Miles Davis":
                                         artistEntry.profile = "One of the most influential and acclaimed figures in the history of jazz, trumpeter Miles Davis was at the forefront of several major stylistic developments, including cool jazz, hard bop, modal jazz, and jazz fusion.";
                                         break;
                                     case "Thelonious Monk":
                                          artistEntry.profile = "A pioneering pianist and composer, Thelonious Monk was a central figure in the development of bebop. His unique improvisational style, characterized by dissonant harmonies and angular melodic twists, made him an icon of modern jazz.";
                                          break;
                                     case "Horace Silver":
                                          artistEntry.profile = "A pianist and composer, Horace Silver was a key architect of the hard bop style, known for his catchy, bluesy, and often funk-infused compositions. His quintet was a launching pad for many of the era's top young musicians.";
                                          break;
                                     case "Max Roach":
                                         artistEntry.profile = "A pioneering bebop drummer, Max Roach was also a key figure in the development of hard bop and a leading voice in political jazz. His 'Freedom Now Suite' is a landmark of the Civil Rights era.";
                                         break;
                                     case "Dexter Gordon":
                                          artistEntry.profile = "A towering figure of the tenor saxophone, Dexter Gordon was a bebop pioneer who returned to prominence in the 1960s with a series of classic Blue Note albums that defined the hard bop sound.";
                                          break;
                                 }
                            }
                            instrumentsString.split(/, | \/ /).forEach(inst => {
                                const trimmedInst = inst.trim();
                                if (trimmedInst && !/vocals|arranger|reeds/i.test(trimmedInst)) {
                                    artistEntry.instruments.add(trimmedInst);
                                }
                            });
                            artistEntry.albums.add(track.album);
                        }
                    });
                });
                
                const artistsArray = Array.from(artistsMap.values());
                artistsArray.forEach(artist => {
                    artist.instruments = Array.from(artist.instruments);
                    artist.albums = Array.from(artist.albums);
                });
                return artistsArray;
            }

            function populateInstrumentFilter(artists) {
                const allInstruments = new Set();
                artists.forEach(artist => {
                    artist.instruments.forEach(instrument => allInstruments.add(instrument));
                });
                
                const sortedInstruments = Array.from(allInstruments).sort();

                instrumentFilter.innerHTML = '<option value="all">All Instruments</option>';
                sortedInstruments.forEach(instrument => {
                    const option = document.createElement('option');
                    option.value = instrument;
                    option.textContent = instrument.charAt(0).toUpperCase() + instrument.slice(1);
                    instrumentFilter.appendChild(option);
                });
            }
            
            function renderArtistSlider(artistsToRender) {
                const artistScrollLeftBtn = document.getElementById('artist-scroll-left-btn');
                const artistScrollRightBtn = document.getElementById('artist-scroll-right-btn');
                
                artistsSliderWrapper.innerHTML = ''; 
                artistsSliderContainer.scrollLeft = 0;

                if (artistsToRender.length === 0) {
                    artistsSliderWrapper.innerHTML = `<div class="w-full text-center p-8 text-stone-500">No artist data available.</div>`;
                    if (artistScrollLeftBtn) artistScrollLeftBtn.style.display = 'none';
                    if (artistScrollRightBtn) artistScrollRightBtn.style.display = 'none';
                    return;
                }

                artistsToRender.sort((a, b) => {
                    if (a.isBandleader !== b.isBandleader) {
                        return a.isBandleader ? -1 : 1; 
                    }
                    return a.name.localeCompare(b.name); 
                });
                
                if (artistScrollLeftBtn) artistScrollLeftBtn.style.display = 'block';
                if (artistScrollRightBtn) artistScrollRightBtn.style.display = 'block';
                
                const isMobile = window.innerWidth < 768;
                const batchSize = isMobile ? 6 : 12;
                const numPages = Math.ceil(artistsToRender.length / batchSize);

                for (let i = 0; i < numPages; i++) {
                    const batch = artistsToRender.slice(i * batchSize, (i + 1) * batchSize);
                    const page = document.createElement('div');
                    page.className = 'artist-page';
                    
                    batch.forEach(artist => {
                        const card = document.createElement('div');
                        card.className = 'artist-card';
                        
                        if (artist.isBandleader) {
                            card.style.boxShadow = `4px 4px 0px var(--accent)`;
                        }
                        
                        card.dataset.artistName = artist.name;
                        
                        const placeholderUrl = `https://placehold.co/200x240/1c1917/f5f5f4?text=${encodeURIComponent(artist.name)}`;
                        card.innerHTML = `
                            <div class="h-56 bg-stone-900">
                                <img src="${artist.photo || ''}" alt="Photo of ${artist.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='${placeholderUrl}';">
                            </div>
                            <div class="p-3">
                                <h4 class="font-bold text-base text-stone-900 truncate">${artist.name}</h4>
                            </div>`;

                        card.addEventListener('click', () => openArtistModal(artist));
                        page.appendChild(card);
                    });
                    
                    artistsSliderWrapper.appendChild(page);
                }

                let currentArtistPage = 0;
                function updateArtistSliderButtons() {
                    if (artistScrollLeftBtn) artistScrollLeftBtn.disabled = currentArtistPage === 0;
                    if (artistScrollRightBtn) artistScrollRightBtn.disabled = currentArtistPage >= numPages - 1;
                }
                
                updateArtistSliderButtons(); // Initial state

                if (artistScrollLeftBtn) artistScrollLeftBtn.onclick = () => {
                     if (currentArtistPage > 0) {
                         currentArtistPage--;
                         artistsSliderContainer.scrollTo({ left: artistsSliderContainer.clientWidth * currentArtistPage, behavior: 'smooth' });
                         updateArtistSliderButtons();
                     }
                };
    
                if (artistScrollRightBtn) artistScrollRightBtn.onclick = () => {
                    if (currentArtistPage < numPages - 1) {
                         currentArtistPage++;
                         artistsSliderContainer.scrollTo({ left: artistsSliderContainer.clientWidth * currentArtistPage, behavior: 'smooth' });
                         updateArtistSliderButtons();
                    }
                };
                
                // This listener is for updating buttons when user DRAGS the slider.
                let scrollTimeout;
                artistsSliderContainer.onscroll = () => {
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(() => {
                        const newPage = Math.round(artistsSliderContainer.scrollLeft / artistsSliderContainer.clientWidth);
                        if(newPage !== currentArtistPage) {
                           currentArtistPage = newPage;
                           updateArtistSliderButtons();
                        }
                    }, 250);
                };
            }

            const artistModal = document.getElementById('artist-modal');
            const artistModalContent = artistModal.querySelector('.modal-content');
            
            function openArtistModal(artist) {
                artistModal.querySelector('#artist-modal-title').textContent = artist.name;
                const body = artistModal.querySelector('#artist-modal-body');
                const placeholderUrl = `https://placehold.co/200x240/1c1917/f5f5f4?text=${encodeURIComponent(artist.name)}`;
                
                let profileHtml = '';
                if(artist.isBandleader && artist.profile) {
                    profileHtml = `
                    <div class="mt-6 pt-4 border-t-2 border-stone-200">
                        <h4 class="text-2xl text-stone-900 mb-2">Profile</h4>
                        <p class="text-base text-stone-700 leading-relaxed">${artist.profile}</p>
                    </div>`;
                }

                body.innerHTML = `
                <div class="flex flex-col sm:flex-row gap-6">
                    <div class="w-full sm:w-1/3 flex-shrink-0">
                        <img src="${artist.photo || ''}" class="w-full h-auto rounded-sm border-2 border-stone-900" onerror="this.onerror=null;this.src='${placeholderUrl}';">
                    </div>
                    <div class="w-full sm:w-2/3">
                        <h4 class="text-3xl text-stone-900 mb-3">Details</h4>
                        <p class="mb-4 text-stone-900"><strong class="font-bold">Instruments:</strong> ${artist.instruments.join(', ')}</p>
                        <h4 class="text-3xl text-stone-900 mb-3">Album Appearances</h4>
                        <ul class="list-disc list-inside text-sm space-y-1 text-stone-900 h-32 overflow-y-auto">${artist.albums.map(title => `<li>${title}</li>`).join('')}</ul>
                    </div>
                </div>
                ${profileHtml}
                `;
                artistModal.classList.remove('opacity-0', 'pointer-events-none');
                artistModalContent.classList.remove('scale-95');
            }

            function closeArtistModal() {
                artistModal.classList.add('opacity-0', 'pointer-events-none');
                artistModalContent.classList.add('scale-95');
            }
            
            artistModal.querySelector('#close-artist-modal').addEventListener('click', closeArtistModal);
            artistModal.addEventListener('click', e => { if (e.target.id === 'artist-modal') closeArtistModal(); });
            document.addEventListener('keydown', e => { if (e.key === "Escape") { closeAlbumModal(); closeArtistModal(); } });
            
            const matrixTableBody = document.querySelector('#style-matrix-table tbody');
            if (styleMatrixData.length > 0) {
                matrixTableBody.innerHTML = styleMatrixData.map(row => `<tr class="border-b-2 border-stone-200" data-feature="${row.feature}"><td class="p-4 font-bold">${row.feature}</td><td class="p-4" data-style="Hard Bop">${row.hardBop}</td><td class="p-4" data-style="Modal Jazz">${row.modalJazz}</td><td class="p-4 bg-orange-500/10" data-style="Post-Bop">${row.postBop}</td><td class="p-4" data-style="Free Jazz">${row.freeJazz}</td></tr>`).join('');

                document.querySelectorAll('#style-matrix-table th, #style-matrix-table td').forEach(cell => {
                    cell.addEventListener('mouseenter', () => {
                        const colIndex = cell.cellIndex;
                        const rowIndex = cell.parentElement.rowIndex;
                        const table = cell.closest('table');
                        
                        // Highlight row
                        const rowCells = table.rows[rowIndex].cells;
                        for(let i=0; i<rowCells.length; i++) {
                            rowCells[i].classList.add('highlight');
                        }
                        
                        // Highlight column
                        for(let i=0; i<table.rows.length; i++) {
                            table.rows[i].cells[colIndex].classList.add('highlight');
                        }
                    });
                    cell.addEventListener('mouseleave', () => {
                        document.querySelectorAll('#style-matrix-table .highlight').forEach(c => c.classList.remove('highlight'));
                    });
                });
            } else {
                 matrixTableBody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-stone-500">No genre data available.</td></tr>';
            }
            
            document.getElementById('mobile-nav').addEventListener('change', e => {
                 const targetId = e.target.value;
                 const targetElement = document.querySelector(targetId);
                 if (targetElement) {
                     // Using smooth scroll behavior
                     window.scrollTo({
                         top: targetElement.offsetTop - 80, // Adjust for sticky header
                         behavior: 'smooth'
                     });
                 }
            });
            
            function setupDraggable(container) {
                if (!container) return;
                let isDown = false;
                let startX;
                let scrollLeft;
                container.addEventListener('mousedown', (e) => {
                    isDown = true;
                    container.style.cursor = 'grabbing';
                    startX = e.pageX - container.offsetLeft;
                    scrollLeft = container.scrollLeft;
                });
                container.addEventListener('mouseleave', () => { isDown = false; container.style.cursor = 'grab'; });
                container.addEventListener('mouseup', () => { isDown = false; container.style.cursor = 'grab'; });
                container.addEventListener('mousemove', (e) => {
                    if(!isDown) return;
                    e.preventDefault();
                    const x = e.pageX - container.offsetLeft;
                    const walk = (x - startX) * 2;
                    container.scrollLeft = scrollLeft - walk;
                });
            }

            setupDraggable(timelineContainer);
            setupDraggable(artistsSliderContainer);

        }
    </script>
</body>
</html>
