<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlled Freedom: An Interactive Jazz Encyclopedia</title>
    
    <!-- External Libraries & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;700;900&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    
    <!-- Custom CSS Styling -->
    <style>
        /* Define custom color properties for easy theme management */
        :root {
            --bg-main: #f5f5f4; /* stone-100 */
            --bg-secondary: #e7e5e4; /* stone-200 */
            --bg-dark: #1a1a1a; /* Custom dark gray */
            --text-main: #1c1917; /* stone-900 */
            --text-muted: #57534e; /* stone-600 */
            --accent: #f97316; /* orange-500 */
            --accent-dark: #ea580c; /* orange-600 */
            --yellow-accent: #facc15; /* yellow-400 */

            /* Genre Colors */
            --genre-bebop: #C19A6B; /* Pastel Brown */
            --genre-hard-bop: #d8b4fe; /* purple-300 */
            --genre-cool-jazz: #93c5fd; /* blue-300 */
            --genre-modal-jazz: #a7f3d0; /* emerald-200 */
            --genre-post-bop: #fed7aa; /* orange-200 */
            --genre-free-jazz: #fca5a5; /* red-300 */
            --genre-avant-garde: #fecdd3; /* rose-200 */
            --genre-jazz-fusion: #a5f3fc; /* cyan-200 */
            --genre-default: #e7e5e4; /* stone-200 */
        }

        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
        }
        
        /* Heading font styling with new Bebas Neue font */
        h1, h2, h3, h4, h5 {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.05em;
        }

        /* Navigation link transition effects */
        .nav-link {
            transition: color 0.2s;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.1em;
            font-size: 1.1rem;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--accent);
        }

        /* Section header styling */
        .section-header {
              transform: rotate(-1deg);
              display: inline-block;
              background-color: var(--accent);
              color: var(--bg-main);
              padding: 0.25rem 1rem;
              margin-bottom: 1rem;
        }
        
        /* Compact Matrix Styling */
        #genre-matrix-container {
            border: 2px solid var(--text-main);
            border-radius: 0.25rem;
            overflow: auto; /* Enable scrolling */
            max-height: 70vh; /* Set a max height */
            background-color: var(--bg-main);
        }
        .matrix-table {
            border-collapse: collapse;
            width: 100%;
            min-width: 800px; /* Adjust min-width since a column is removed */
        }
        .matrix-table th, .matrix-table td {
            padding: 1rem;
            border-bottom: 2px solid var(--bg-secondary);
            text-align: left;
            vertical-align: top;
            transition: background-color 0.1s ease-in-out;
        }
        .matrix-table thead th {
            background-color: var(--text-main);
            color: var(--bg-main);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .matrix-table tbody th {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem;
            width: 150px;
            position: sticky;
            left: 0;
            z-index: 5;
            border-right: 2px solid var(--bg-secondary);
        }
        .matrix-table tbody tr:last-child th, .matrix-table tbody tr:last-child td {
            border-bottom: none;
        }
        .matrix-table td.col-hover, .matrix-table .row-hover > td {
            background-color: var(--highlight-color, rgba(0,0,0,0.05)) !important;
        }
        .genre-header-button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            text-align: left;
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
        }
        .genre-header-button .info-icon {
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        .genre-header-button:hover .info-icon {
            opacity: 1;
        }


        /* Modal transition styles */
        .modal {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        .modal.opacity-0 .modal-content {
              opacity: 0;
              transform: scale(0.95) translateY(10px);
        }
        
        /* Horizontal draggable timeline container */
        #horizontal-timeline-container {
            position: relative;
            width: 100%;
            overflow-x: auto;
            cursor: grab;
            border: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #horizontal-timeline-container:active {
            cursor: grabbing;
        }
        #horizontal-timeline-container::-webkit-scrollbar {
            display: none;
        }

        /* Canvas for drawing connection lines */
        #timeline-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allows clicks to pass through to the cards */
            z-index: 1;
        }
        /* Wrapper for all timeline content */
        #timeline-wrapper {
            position: relative;
            display: inline-flex;
            align-items: flex-start;
            padding: 2rem 1rem;
            padding-top: 5rem; /* MODIFIED: Make space for sticky header */
            z-index: 2; /* Ensure cards are above the canvas */
        }
        /* Styling for each year's section in the timeline */
        .timeline-year-section {
            display: flex;
            flex-shrink: 0;
            flex-direction: column;
            align-items: center; /* Center pagination controls */
            border-left: 4px dotted #a8a29e; /* MODIFIED: Darker dotted line (stone-400) */
            padding: 0 2rem;
        }
        .timeline-year-section:first-child {
            border-left: none;
        }
        /* Year header styling */
        .timeline-year-header {
           display: none; /* MODIFIED: Hide the inline headers */
        }
        /* Grid for album cards within a year */
        .timeline-album-list {
            display: grid;
            grid-template-rows: repeat(2, 1fr);
            grid-auto-flow: column;
            gap: 1.5rem;
            min-height: 520px; /* Adjust height to fit two rows of cards + gap */
        }
        /* Individual album card styling */
        .timeline-album-card {
            width: 200px;
            flex-shrink: 0;
            background-color: var(--bg-main);
            border-radius: 0.25rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
            box-shadow: 4px 4px 0px var(--text-main);
            border: 2px solid var(--text-main);
            overflow: hidden;
            opacity: 1;
        }
        .timeline-album-card:hover {
            transform: translateY(-5px) rotate(2deg);
        }
        .timeline-album-card.dimmed {
            opacity: 0.5;
        }
        .timeline-album-card.highlighted {
            opacity: 1;
            box-shadow: 8px 8px 0px var(--highlight-color, var(--accent));
        }
        /* Style for the card that is currently selected/clicked */
        .timeline-album-card.clicked {
            transform: translateY(-5px) rotate(2deg) scale(1.05);
            box-shadow: 8px 8px 0px var(--accent) !important;
            opacity: 1 !important;
            z-index: 10;
        }
        .timeline-album-card.landmark-album {
            border-width: 4px;
            border-color: var(--landmark-color, var(--accent));
            box-shadow: 0 0 15px 0px var(--landmark-color, var(--accent));
        }
        .timeline-album-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }
        .timeline-album-card:hover img, .timeline-album-card.highlighted img, .timeline-album-card.clicked img {
            filter: grayscale(0%);
        }
        .timeline-album-card-info {
            padding: 0.75rem;
        }
        .timeline-album-card-info h5 {
            color: var(--text-main);
            font-size: 1.25rem;
        }
        .timeline-album-card-info p {
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
        }
        /* Artist card styling */
        .artist-card {
            background-color: var(--bg-main);
            border-radius: 0.25rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 4px 4px 0px var(--text-main);
            border: 2px solid var(--text-main);
            transform: translateZ(0); /* Promotes the element to a new compositing layer */
            -webkit-backface-visibility: hidden; /* Safari fix for flickering */
            backface-visibility: hidden; /* Standard fix for flickering */
        }
        .artist-card:hover {
            transform: translateY(-5px) rotate(2deg);
            box-shadow: 8px 8px 0px var(--accent) !important; /* Ensure hover always wins */
        }
        .artist-card.bandleader {
            box-shadow: 4px 4px 0px var(--accent);
        }
        .artist-card.influential-sideman {
            box-shadow: 4px 4px 0px var(--yellow-accent);
        }
        .artist-card .artist-photo-container {
              height: 224px;
              width: 100%;
        }
        .artist-card img {
              width: 100%;
              height: 100%;
              object-fit: cover;
              object-position: center;
              filter: grayscale(100%);
              transition: filter 0.3s ease;
        }
         .artist-card:hover img {
            filter: grayscale(0%);
        }
        .artist-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background-color: #1c1917; /* stone-900 */
        }
        .artist-placeholder svg {
            width: 50%;
            height: 50%;
            color: #a8a29e; /* stone-400 */
        }
        
        /* Artist Slider Styling */
        #artist-slider-container {
            overflow: hidden;
        }
        #artist-slider-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .artist-slider-page {
            width: 100%;
            flex-shrink: 0;
            padding: 0 0.5rem; /* Add some padding so cards don't touch edges */
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Mobile: 3 columns */
            gap: 1.5rem;
        }
        @media (min-width: 768px) { /* Tablet and Web: 6 columns */
            .artist-slider-page {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        .styled-select select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f97316' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1.2em;
        }

        /* Modal Night Mode & Player Styles */
        #modal-analysis-section {
            background-color: var(--bg-dark);
            padding: 1.5rem;
            margin-top: 2rem;
            border: 2px solid var(--text-main);
            box-shadow: 4px 4px 0px var(--text-main);
        }
        #modal-analysis-section h5 {
            color: var(--bg-main);
        }
        
        .liner-notes-text {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            color: #d4d4d2; 
        }
        
        audio.styled-player {
            height: 35px; 
            accent-color: var(--accent);
        }

        /* Genre Filter Checkbox Styling */
        #genre-filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .genre-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border: 2px solid var(--text-main);
            border-radius: 9999px;
            background-color: var(--bg-main);
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .genre-checkbox-label input {
            appearance: none;
            -webkit-appearance: none;
            display: none;
        }
        .genre-checkbox-label:has(input:checked) {
            background-color: var(--genre-color, var(--accent));
            color: var(--text-main);
        }
        .genre-checkbox-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* Scrollbar Marker Styling */
        #custom-scrollbar-markers {
            position: absolute;
            top: -5px; /* Position it slightly above the scrollbar track */
            left: 0;
            right: 0;
            height: 10px;
            pointer-events: none; /* So it doesn't interfere with clicks on the scrollbar */
        }
        .scrollbar-marker {
            position: absolute;
            width: 2px;
            height: 100%;
            background-color: var(--accent);
            transform: translateX(-50%); /* Center the marker on its position */
        }
        .scrollbar-marker::after {
            content: attr(data-year);
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            font-weight: bold;
            color: var(--text-muted);
        }

        /* Loading indicator styles */
        #loader {
            position: fixed;
            inset: 0;
            background-color: var(--bg-main);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .loader-spinner {
            border: 4px solid var(--bg-secondary);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .content-hidden {
            display: none;
        }
        
        .genre-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
            border: 2px solid var(--text-main);
        }

        .hidden {
            display: none !important;
        }

        /* Style for clickable links in modals */
        .clickable-link {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-color: var(--accent);
            transition: color 0.2s;
        }
        .clickable-link:hover {
            color: var(--accent);
        }

        /* Animation for fade-in on scroll */
        .fade-in-element {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .fade-in-element.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .title-rotate {
            transform: rotate(-1.5deg);
            margin-top: 35px;
        }
        .nav-bar-hidden-behaviour {
            display: flex;
            transform: rotate(-1.5deg);
        }
        @media (max-width: 640px) {
            .nav-bar-hidden-behaviour {
                display: none;
            }
        }

        /* Nudge animation for scroll buttons */
        @keyframes nudge-right {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(8px); }
        }
        .nudge-animation {
            animation: nudge-right 1.5s ease-in-out 3;
        }

        /* Mobile Menu Panel Transition */
        #mobile-menu-panel {
            transition: transform 0.3s ease-in-out;
        }
        #mobile-menu-overlay.hidden #mobile-menu-panel {
            transform: translateX(100%);
        }
        
        .landmark-album-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem 1rem;
            list-style-position: inside;
        }
   
    </style>
</head>
<body class="bg-stone-100 text-stone-900">

    <!-- Full-screen loader -->
    <div id="loader">
        <div class="loader-spinner"></div>
    </div>

    <div id="page-content" class="content-hidden">
        <!-- HEADER -->
        <div class="sticky top-0 z-50 h-24 mb-[-64px]">
              <header class="relative container mx-auto h-full">
                    <!-- This is the crooked background. It is positioned absolutely within the header -->
                    <div class="absolute inset-x-0 top-4 h-20 bg-stone-100 border-2 border-stone-900" style="transform: rotate(-1.5deg); box-shadow: 5px 5px 0px var(--text-main); z-index: 1;"></div>
                    
                    <!-- This is the navigation content. It is NOT rotated and sits on top of the background -->
                    <nav class="relative z-10 flex items-center justify-between h-full px-4 sm:px-6 lg:px-8">
                        <h1 class="title-rotate text-3xl md:text-4xl font-bold text-stone-900 tracking-tight">Controlled Freedom</h1>
                        <div class="nav-bar-hidden-behaviour sm:items-baseline sm:space-x-8">
                            <a href="#overview" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Overview</a>
                            <a href="#timeline" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Timeline</a>
                            <a href="#matrix" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Genres</a>
                            <a href="#artists" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Artists</a>
                            <a href="#legacy" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Legacy</a>
                        </div>
                        <!-- MODIFICATION: Hamburger Menu Button -->
                        <div class="sm:hidden">
                            <button id="mobile-menu-button" class="p-2 -mr-2 rounded-md text-stone-900 hover:bg-stone-200 focus:outline-none">
                                <svg class="h-8 w-8" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                                </svg>
                            </button>
                        </div>
                    </nav>
                </header>
        </div>


        <main>
            <!-- Hero Banner Section -->
            <section id="banner" class="relative w-full h-56 md:h-72 lg:h-[26rem]">
                <img src="images/banner.jpg" alt="Post-bop musicians in a rehearsal space" class="w-full h-full object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1511192336575-5a79af67d629?q=80&w=2074&auto=format&fit=crop';">
                <div class="absolute inset-x-0 bottom-0 h-1/3 bg-gradient-to-t from-stone-100 to-transparent"></div>
            </section>

            <!-- Overview Section -->
            <section id="overview" class="pt-12 pb-16 sm:pb-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl">
                    <div class="text-center mb-12">
                        <h2 class="section-header text-5xl">A Jazz Evolution Encyclopedia</h2>
                        <p class="text-center text-lg text-stone-600 mt-4 italic">Follow the development of modern jazz through the 50s and 60s.</p>
                    </div>
                    <div class="grid md:grid-cols-5 gap-12 items-start">
                        <div class="md:col-span-3 space-y-6 text-base md:text-lg leading-relaxed text-stone-900 text-left">
                            <p>The period between 1950 and 1969 represents the most accelerated and dynamic evolution in jazz history. From the virtuosic fire of <strong>Bebop</strong>, the music branched into myriad new forms. Some musicians pursued the soulful, blues-drenched energy of <strong>Hard Bop</strong>, while others explored the harmonically rich, restrained arrangements of <strong>Cool Jazz</strong>.</p>
                            <p>At the heart of this era lies the central theme of <strong style="color: var(--accent);">"controlled freedom."</strong> The philosophy of <strong>Post-Bop</strong> sought a middle ground between dense structures and the radical abandon of the burgeoning <strong>Free Jazz</strong> and <strong>Avant-Garde</strong> scenes, introducing new harmonic and rhythmic complexity while still retaining elements of form and melody.</p>
                            <p>This application provides an interactive journey through this interconnected history, ordered by recording date—not release date—to understand the influence exercised between all these musicians and <strong>reveal the authentic path of jazz evolution as it happened.</strong></p>
                        </div>
                        <div class="md:col-span-2 mt-8 md:mt-0">
                            <iframe style="border-radius:12px" src="https://open.spotify.com/embed/playlist/6nFqx9JIZD29Qxccp6mh4N?utm_source=generator" width="100%" height="500" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Interactive Timeline Section -->
            <section id="timeline" class="py-16 sm:py-20 bg-stone-300 border-y-4 border-stone-900">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="section-header text-5xl">Timeline Explorer</h2>
                    <p class="text-center text-lg text-stone-600 mb-8 max-w-3xl mx-auto italic">Use the filters to explore a year-by-year breakdown of landmark albums.</p>
                    
                    <!-- Timeline Filter Controls -->
                    <div id="timeline-controls" class="flex flex-col items-center justify-center gap-4 mb-8">
                        <div id="genre-filter-container" class="flex flex-wrap justify-center gap-x-4 gap-y-3">
                           <!-- Checkboxes will be injected here by JavaScript -->
                        </div>
                    </div>

                    <div class="relative group">
                        <!-- Sticky Year Display -->
                        <div id="sticky-year-display" class="absolute top-0 left-1 sm:left-4 font-black text-orange-600 text-6xl transition-opacity duration-200 pointer-events-none z-10"></div>

                        <div id="horizontal-timeline-container" class="min-h-[600px] flex items-center">
                            <canvas id="timeline-canvas"></canvas>
                            <div id="timeline-wrapper"></div>
                        </div>
                        <button id="scroll-left-btn" class="absolute left-0 sm:-left-4 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        </button>
                        <button id="scroll-right-btn" class="absolute right-0 sm:-right-4 top-1/2 -translate-y-1/2 z-20 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </div>
                    <!-- Custom Scrollbar with Markers -->
                    <div class="mt-6">
                        <div id="custom-scrollbar" class="w-full h-3 bg-stone-200 rounded-full cursor-pointer relative">
                            <div id="custom-scrollbar-markers"></div>
                            <div id="custom-scrollbar-thumb" class="h-full bg-stone-900 rounded-full absolute top-0 cursor-grab"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Genre Matrix Section -->
            <section id="matrix" class="py-16 sm:py-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="section-header text-5xl">The Genres</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Compare the main aspects of each style.</p>
                    <div id="genre-matrix-container" class="matrix-container max-w-6xl mx-auto">
                        <table id="style-matrix-table" class="matrix-table">
                            <!-- Table content will be generated here -->
                        </table>
                    </div>
                </div>
            </section>

            <!-- Key Artists Grid Section -->
            <section id="artists" class="py-16 sm:py-20 bg-stone-200 border-y-4 border-stone-900">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="section-header text-5xl">The Architects</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Explore the musicians who defined an era.</p>
                    
                    <!-- Instrument Filter Dropdown -->
                    <div class="flex justify-center mb-8">
                        <div class="w-full max-w-xs styled-select">
                            <label for="instrument-filter" class="block text-sm font-medium text-stone-600 mb-2 text-center">Filter by Instrument:</label>
                            <select id="instrument-filter" class="block w-full rounded-sm border-2 border-stone-900 bg-stone-100 text-stone-900 py-2 pl-3 pr-10 focus:border-orange-500 focus:outline-none focus:ring-orange-500 font-bold">
                            </select>
                        </div>
                    </div>

                    <!-- Artist Slider Container -->
                    <div id="artist-slider-wrapper" class="relative">
                        <div id="artist-slider-container" class="min-h-[550px] md:min-h-[580px]">
                            <div id="artist-slider-track">
                                <!-- Artist pages will be injected here by JavaScript -->
                            </div>
                        </div>
                         <!-- Artist Pagination Controls -->
                        <div id="artist-pagination-controls" class="absolute inset-x-0 -bottom-12 flex justify-center items-center gap-4">
                            <button id="artist-prev-btn" class="pointer-events-auto p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all disabled:opacity-25 disabled:cursor-not-allowed">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                            </button>
                            <span id="artist-page-indicator" class="font-bold text-lg text-stone-900 pointer-events-auto"></span>
                            <button id="artist-next-btn" class="pointer-events-auto p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all disabled:opacity-25 disabled:cursor-not-allowed">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                            </button>
                       </div>
                    </div>
                </div>
            </section>
            
            <!-- Legacy Section -->
            <section id="legacy" class="py-16 sm:py-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl text-center">
                    <h2 class="section-header text-5xl">Legacy</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 italic">How a golden age splintered into new forms, leaving an indelible mark on music.</p>
                    <div class="space-y-6 text-base md:text-lg leading-relaxed text-stone-900 text-left">
                        <p>The golden age of acoustic innovation, from 1950 to 1969, was the crucible in which the modern jazz lexicon was forged. It was a period of intense, shared creativity where a cohesive musical language was established. However, by the late 1960s, this center began to splinter as the music’s evolution bifurcated. The death of John Coltrane in 1967 left a profound spiritual and musical void for the avant-garde, decentralizing its forward momentum. Simultaneously, Miles Davis, the music's restless visionary, pivoted toward electric instruments and funk-rock rhythms. With albums like In a Silent Way and Bitches Brew, he abandoned the acoustic mainstream and single-handedly created a new, electrified one that would define the sound of the 1970s.</p>
                        <p>Yet, the legacy of the preceding two decades proved indelible. The harmonic sophistication of Bebop, the soulful grammar of Hard Bop, the textural subtlety of Cool Jazz, and the expansive freedom of Modal and Post-Bop were codified into a shared musical playbook. This inheritance was most explicitly reclaimed in the 1980s by the "Young Lions" movement, led by trumpeter Wynton Marsalis, which re-centered the jazz narrative on the acoustic, small-group aesthetic of this era.</p>
                        <p>This revival cemented the 1950-1969 period as the music's "classical" age, establishing a foundation that remains paramount. Its language is now the bedrock for contemporary acoustic jazz education and performance worldwide. Today’s musicians internalize this vocabulary not as a historical artifact, but as a living tradition—a rich syntax to be honored, deconstructed, or fused with other genres to forge the future of the art form.</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-stone-900 text-stone-200 py-8">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <p class="font-bold">An interactive exploration based on the "Chronological Encyclopedia of Jazz".</p>
                <p class="text-sm text-stone-400 mt-2">Designed to bring music history to life through interactive data visualization.</p>
                <div class="mt-6 border-t border-stone-700 pt-6">
                    <p id="footer-copyright" class="text-xs text-stone-400"></p>
                    <p class="text-xs text-stone-500 mt-2">Disclaimer: All music and images are the property of their respective copyright holders. This is a non-profit project for educational purposes only.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Modals -->
    <div id="album-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div id="modal-content" class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                <div>
                    <h3 id="modal-title" class="text-4xl text-orange-500"></h3>
                    <button id="modal-artist" class="text-xl text-stone-600 bg-transparent border-none p-0"></button>
                </div>
                <button id="close-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">×</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div id="modal-album-main-details" class="flex flex-col md:flex-row gap-6">
                    <div id="modal-album-art-container" class="w-full md:w-1/3 flex-shrink-0">
                        <img id="modal-album-art" src="" class="w-full h-auto rounded-sm border-2 border-stone-900" alt="" loading="lazy">
                    </div>
                    <div id="modal-album-details" class="w-full md:w-2/3"></div>
                </div>
                <div id="analysis-wrapper" class="relative mt-4">
                    <!-- Content injected by JS -->
                </div>
            </div>
             <!-- Modal Navigation Footer -->
            <div id="modal-nav-footer" class="flex justify-between items-center p-4 border-t-2 border-stone-900 flex-shrink-0 bg-stone-200">
                <button id="prev-album-btn" class="px-4 py-2 bg-stone-900 text-stone-100 rounded-sm font-bold hover:bg-orange-500 transition-colors disabled:bg-stone-400 disabled:cursor-not-allowed">Previous Album</button>
                <button id="next-album-btn" class="px-4 py-2 bg-stone-900 text-stone-100 rounded-sm font-bold hover:bg-orange-500 transition-colors disabled:bg-stone-400 disabled:cursor-not-allowed">Next Album</button>
            </div>
        </div>
    </div>
    <div id="artist-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
             <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                 <h3 id="artist-modal-title" class="text-4xl text-orange-500"></h3>
                 <button id="close-artist-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">×</button>
             </div>
             <div id="artist-modal-body" class="p-6 overflow-y-auto"></div>
        </div>
    </div>
    <div id="genre-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
             <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                 <h3 id="genre-modal-title" class="text-4xl"></h3>
                 <button id="close-genre-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">×</button>
             </div>
             <div id="genre-modal-body" class="p-6 overflow-y-auto"></div>
        </div>
    </div>

    <!-- MODIFICATION: Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="hidden fixed inset-0 z-50">
        <div id="mobile-menu-bg" class="fixed inset-0 bg-black opacity-50"></div>
        <div id="mobile-menu-panel" class="fixed top-0 right-0 bottom-0 bg-stone-100 w-64 shadow-lg p-4 transform translate-x-full">
            <div class="flex justify-end mb-4">
                <button id="mobile-menu-close-button" class="p-2 -mr-2 rounded-md text-stone-900 hover:bg-stone-200 focus:outline-none">
                     <svg class="h-8 w-8" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <nav id="mobile-nav-links" class="flex flex-col space-y-4">
                <a href="#overview" class="mobile-nav-link text-lg font-bold text-stone-900 hover:text-orange-500">Overview</a>
                <a href="#timeline" class="mobile-nav-link text-lg font-bold text-stone-900 hover:text-orange-500">Timeline</a>
                <a href="#matrix" class="mobile-nav-link text-lg font-bold text-stone-900 hover:text-orange-500">Genres</a>
                <a href="#artists" class="mobile-nav-link text-lg font-bold text-stone-900 hover:text-orange-500">Artists</a>
                <a href="#legacy" class="mobile-nav-link text-lg font-bold text-stone-900 hover:text-orange-500">Legacy</a>
            </nav>
        </div>
    </div>


    <!-- Embedded Genre Matrix Data -->
    <script id="styleMatrixData" type="application/json">
    {
        "features": ["Harmony", "Rhythm", "Form"],
        "genres": {
            "Bebop": {
                "profile": "The furious, intellectual, and virtuosic revolution of the 1940s that became the foundation for all modern jazz. Bebop emphasized complex melodies over sophisticated chord progressions at blistering tempos, shifting jazz from dance music to a high art form for dedicated listeners.",
                "color": "var(--genre-bebop)",
                "data": [
                    "Fast-moving, complex chord progressions (e.g., ii-V-I with substitutions), use of altered chords and extensions.",
                    "Blistering tempos, virtuosic and rhythmically complex solos, 'dropping bombs' with the bass drum.",
                    "Often based on standard song forms (like blues and 'I Got Rhythm' changes) but used as vehicles for extended improvisation."
                ],
                "artists": "Charlie Parker, Dizzy Gillespie, Thelonious Monk, Bud Powell",
                "landmarkAlbums": ["Bird and Diz", "Sonny Side Up", "The Amazing Bud Powell, Vol. 1", "Lester Young with the Oscar Peterson Trio", "Jazz At Massey Hall", "For Musicians Only"]
            },
            "Hard Bop": {
                "profile": "Evolving from bebop in the mid-1950s, Hard Bop re-injected the music with the earthy, soulful, and danceable influences of blues and gospel. With its strong backbeat, memorable melodies, and fiery solos, it became one of the most popular and enduring styles of the era.",
                "color": "var(--genre-hard-bop)",
                "data": [
                    "Functional (ii-V-I), blues-based, gospel influences",
                    "Strong, driving swing feel, prominent drumming, danceable grooves",
                    "Standard forms (AABA, 12-bar blues), often with catchy, memorable heads"
                ],
                "artists": "Art Blakey, Horace Silver, Clifford Brown, Lee Morgan",
                "landmarkAlbums": ["Moanin'", "Study in Brown", "Saxophone Colossus", "Monk's Music", "Blue Train", "Giant Steps", "Brilliant Corners", "Song For My Father", "Money Jungle", "Mosaic", "The Sidewinder", "The Blues and the Abstract Truth", "Clifford Brown and Max Roach", "Cool Struttin'", "Soul Station", "The Cooker", "Go", "The Scene Changes"]
            },
            "Cool Jazz": {
                "profile": "A reaction to the frenetic energy of bebop, Cool Jazz emerged in the late 1940s and 50s with a more relaxed, subdued, and lyrical approach. It often featured more complex, written arrangements, softer tones, and influences from classical music, creating a sound of understated elegance.",
                "color": "var(--genre-cool-jazz)",
                "data": [
                    "More complex, often drawing from classical harmony, less blues-centric",
                    "Relaxed, subtle pulse, lighter drumming, focus on understatement",
                    "Often employed complex, contrapuntal arrangements and non-standard forms"
                ],
                 "artists": "Miles Davis (early), Dave Brubeck, Stan Getz, Gerry Mulligan",
                 "landmarkAlbums": ["Birth of the Cool", "Dexter Blows Hot and Cool", "Portrait in Jazz", "Time Out", "Somethin' Else", "Out of the Cool", "'Round About Midnight", "Everybody Digs Bill Evans"]
            },
            "Modal Jazz": {
                "profile": "A revolutionary approach pioneered in the late 1950s, Modal Jazz liberated improvisers by focusing on static scales (or modes) for long stretches, rather than rapidly changing chord progressions. This created a more spacious, meditative, and harmonically open soundscape, famously explored on Miles Davis's 'Kind of Blue'.",
                "color": "var(--genre-modal-jazz)",
                "data": [
                    "Static harmony, based on modes/scales rather than chord progressions",
                    "Floating, ambiguous pulse, less aggressive swing, focus on texture",
                    "Open-ended, simple structures, often just a single mode or vamp"
                ],
                "artists": "Miles Davis, John Coltrane, Bill Evans",
                "landmarkAlbums": ["Kind of Blue", "My Favorite Things", "Maiden Voyage", "Waltz for Debby", "Idle Moments", "Africa / Brass", "Olé Coltrane", "Juju", "Miles Smiles", "Milestones"]
            },
            "Post-Bop": {
                "profile": "The adventurous middle ground of the 1960s, Post-Bop took the harmonic complexity of bebop and the freedom of modal jazz and fused them with elements of the avant-garde. It's defined by its intricate original compositions, highly interactive rhythm sections, and 'controlled freedom,' where musicians stretch the boundaries of harmony and form without abandoning them completely.",
                "color": "var(--genre-post-bop)",
                "data": [
                    "Expanded functional harmony, non-functional chords, controlled dissonance",
                    "Highly interactive, fluid time, polyrhythms, elastic sense of swing",
                    "Modified standard forms, original compositions with complex, unique structures"
                ],
                "artists": "Miles Davis's 2nd Quintet, Wayne Shorter, Herbie Hancock, Andrew Hill",
                "landmarkAlbums": ["Mingus Ah Um", "Astigmatic", "Destination... Out!", "Free For All", "Speak No Evil", "Empyrean Isles", "Contours", "Dialogue", "Inner Urge"]
            },
            "Avant-Garde": {
                 "profile": "The 'Avant-Garde' describes a forward-thinking movement where musicians sought to challenge and expand the conventions of jazz. This often involved complex, unconventional compositions, unusual instrumentation, and a blend of structured sections with free improvisation, pushing the music into uncharted intellectual and textural territory.",
                "color": "var(--genre-avant-garde)",
                "data": [
                    "Can include complex, atonal composed sections alongside free improvisation.",
                    "Ranges from free, pulseless textures to complex, composed rhythmic cycles.",
                    "Often features through-composed suites, blending written material with free improvisation."
                ],
                "artists": "Eric Dolphy, Andrew Hill, Grachan Moncur III, Sun Ra",
                "landmarkAlbums": ["The Black Saint and the Sinner Lady", "Out to Lunch!", "The Shape of Jazz to Come", "Point of Departure", "A Love Supreme", "Karma", "We Insist! Max Roach's Freedom Now Suite", "Change of the Century"]
            },
            "Free Jazz": {
                "profile": "The most radical departure of the era, Free Jazz, pioneered by artists like Ornette Coleman, often abandoned preset chord changes, tempos, and forms altogether. The focus shifted to collective, spontaneous improvisation, prioritizing raw energy, texture, and pure sonic expression over traditional musical rules.",
                "color": "var(--genre-free-jazz)",
                "data": [
                    "Abandons conventional chord progressions; focuses on texture and collective improvisation.",
                    "Often abandons a steady pulse; uses 'energy playing' and textural drumming.",
                    "Open forms, often based on a brief theme or motive, or completely improvised."
                ],
                "artists": "Ornette Coleman, Albert Ayler, Cecil Taylor, Pharoah Sanders",
                "landmarkAlbums": ["Ascension", "Free Jazz", "Spiritual Unity", "Conquistador!", "Eternal Rhythm", "Compulsion!!!!!", "Black Woman", "The Magic of Ju-Ju"]
            },
            "Jazz Fusion": {
                "profile": "Emerging in the late 1960s, Jazz Fusion plugged jazz into the amplifier, incorporating the powerful rhythms of rock and funk, and the new textures of electric instruments like the Fender Rhodes piano and electric guitar. Led by Miles Davis, this movement created a dynamic, high-energy sound that would define the next decade of jazz.",
                "color": "var(--genre-jazz-fusion)",
                "data": [
                    "Electric piano (Rhodes, Wurlitzer), synthesizers; post-bop harmony mixed with simpler rock/funk vamps.",
                    "Driving, straight-eighth rock and funk grooves, complex polyrhythms, high-energy drumming.",
                    "Extended, often through-composed forms, long open improvisations over vamps."
                ],
                "artists": "Miles Davis, Herbie Hancock, Weather Report, Mahavishnu Orchestra",
                 "landmarkAlbums": ["In a Silent Way", "Bitches Brew"]
            }
        }
    }
    </script>
    
    <!-- Main Application Script -->
    <script>
const JazzApp={state:{albums:[],artistProfiles:{},artistsData:[],styleMatrix:{},visibleAlbums:[],currentVisibleAlbumIndex:-1,currentArtistPage:0,totalArtistPages:0,lastKnownYear:"",mobileCardSelectedForModal:null,lastHoveredGenre:null},elements:{},init(){this.cacheDOMElements();for(const e in this.methods)"function"==typeof this.methods[e]&&(this.methods[e]=this.methods[e].bind(this));this.fetchData()},cacheDOMElements(){this.elements={loader:document.getElementById("loader"),pageContent:document.getElementById("page-content"),timelineContainer:document.getElementById("horizontal-timeline-container"),timelineWrapper:document.getElementById("timeline-wrapper"),timelineCanvas:document.getElementById("timeline-canvas"),scrollLeftBtn:document.getElementById("scroll-left-btn"),scrollRightBtn:document.getElementById("scroll-right-btn"),genreFilterContainer:document.getElementById("genre-filter-container"),stickyYearDisplay:document.getElementById("sticky-year-display"),albumModal:document.getElementById("album-modal"),artistModal:document.getElementById("artist-modal"),genreModal:document.getElementById("genre-modal"),instrumentFilter:document.getElementById("instrument-filter"),artistSliderTrack:document.getElementById("artist-slider-track"),artistPrevBtn:document.getElementById("artist-prev-btn"),artistNextBtn:document.getElementById("artist-next-btn"),artistPaginationControls:document.getElementById("artist-pagination-controls"),artistPageIndicator:document.getElementById("artist-page-indicator"),matrixContainer:document.getElementById("style-matrix-table"),customScrollbar:document.getElementById("custom-scrollbar"),customScrollbarThumb:document.getElementById("custom-scrollbar-thumb"),customScrollbarMarkers:document.getElementById("custom-scrollbar-markers"),mobileMenuButton:document.getElementById("mobile-menu-button"),mobileMenuOverlay:document.getElementById("mobile-menu-overlay"),mobileMenuPanel:document.getElementById("mobile-menu-panel"),mobileMenuCloseButton:document.getElementById("mobile-menu-close-button"),mobileNavLinks:document.querySelectorAll("#mobile-nav-links a"),sections:document.querySelectorAll("main section[id]"),navLinks:document.querySelectorAll("header nav a"),footerCopyright:document.getElementById("footer-copyright")}},fetchData(){const e=document.getElementById("styleMatrixData");this.state.styleMatrix=JSON.parse(e.textContent),fetch("database.json").then(e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{this.state.albums=e.albums,this.state.artistProfiles=e.artistProfiles,this.initializeAppUI()}).catch(e=>{console.error("Error fetching or parsing database.json:",e),this.elements.pageContent.innerHTML=`<div class="text-center p-8">
                            <h2 class="text-2xl font-bold text-red-600">Failed to Load Data</h2>
                            <p class="text-stone-600 mt-2">Could not fetch album/artist data. Please ensure 'database.json' is available.</p>
                            <p class="text-sm text-stone-500 mt-4">Error: ${e.message}</p>
                        </div>`,this.showPage()})},showPage(){this.elements.loader.style.display="none",this.elements.pageContent.classList.remove("content-hidden")},initializeAppUI(){this.methods.processAndSortData(),this.methods.buildGenreColorMap(),this.methods.setupFilters(),this.methods.renderTimeline(),this.methods.setupTimelineInteraction(),this.methods.setupModals(),this.methods.setupArtistSlider(),this.methods.buildGenreMatrix(),this.methods.setupMobileMenu(),this.methods.setupScrollObservers(),this.methods.setupGeneralEventListeners(),this.methods.renderScrollbarMarkers(),this.showPage(),setTimeout(()=>{this.elements.timelineContainer.scrollLeft=0},0)},methods:{processAndSortData(){const e={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},t=t=>{if("string"!=typeof t)return null;if(t.toLowerCase().startsWith("c.")){const e=t.match(/\d{4}/);if(e)return new Date(parseInt(e[0]),11,31)}const o=t.replace(/,/g,"").split(" ");return 3===o.length&&e.hasOwnProperty(o[0])?new Date(o[2],e[o[0]],o[1]):2===o.length&&e.hasOwnProperty(o[0])?new Date(o[1],e[o[0]],1):1===o.length&&!isNaN(o[0])?new Date(o[0],0,1):null};this.state.albums.forEach(o=>{o.pivotalTracks&&o.pivotalTracks.length>0&&(o.pivotalTracks.sort((o,a)=>t(o.recordingDate)-t(a.recordingDate)),o.firstRecordingDate=o.pivotalTracks[0].recordingDate)}),this.state.albums.sort((e,o)=>t(e.firstRecordingDate)-t(o.firstRecordingDate));const o=this.state.albums.flatMap(e=>e.pivotalTracks.map(t=>({...t,year:e.year,artist:e.artist,album:e.albumTitle,cover:e.cover,genre:e.genres})));this.state.artistsData=this.methods.processArtists(o,this.state.artistProfiles)},processArtists(e,t){const o=new Map,a=this.methods.slugify;return e.forEach(e=>{if(e.lineup){const n=e.lineup.split(/,(?![^()]*\))/);n.forEach(n=>{const i=n.trim().match(/(.+?)\s\((.+)\)/);if(i){let n=i[1].trim();"Anthony Williams"===n&&(n="Tony Williams");const s=i[2];o.has(n)||o.set(n,{name:n,instruments:new Set,albums:new Set,photo:`images/${a(n)}.jpg`,isBandleader:!1,profile:""});const r=o.get(n);e.artist&&e.artist.includes(n)&&(r.isBandleader=!0),t&&t[n]&&(r.profile=t[n]),s.split(/, | \/ /).forEach(e=>{const t=e.trim();t&&!/vocals|arranger|reeds/i.test(t)&&r.instruments.add(t)}),r.albums.add(e.album)}})}}),Array.from(o.values()).forEach(e=>{e.instruments=Array.from(e.instruments),e.albums=Array.from(e.albums),e.isBandleader?e.tier=1:e.albums.length>=4?e.tier=2:e.tier=3}),Array.from(o.values())},buildGenreColorMap(){const e=this.state.styleMatrix.genres?Object.keys(this.state.styleMatrix.genres).reduce((e,t)=>(e[t]=this.state.styleMatrix.genres[t].color,e),{}):{};this.state.fullGenreColorMap={...e},this.state.fullGenreColorMap["Free Jazz"]="var(--genre-free-jazz)",this.state.fullGenreColorMap["Avant-Garde Jazz"]="var(--genre-avant-garde)",this.state.fullGenreColorMap["Jazz Fusion"]="var(--genre-jazz-fusion)",this.state.albums.forEach(e=>{e.genres&&e.genres.split(", ").forEach(e=>{this.state.fullGenreColorMap[e]||(this.state.fullGenreColorMap[e]="var(--genre-default)")})})},setupFilters(){const{genreFilterContainer:e,instrumentFilter:t}=this.elements,o=new Set;this.state.albums.forEach(e=>{e.genres&&e.genres.split(", ").forEach(e=>o.add(e.trim()))});const a=["Bossa Nova","Chamber Jazz","Latin Jazz","Soul Jazz","Spiritual Jazz","Afro-Jazz","Ambient Jazz","Jazz-Funk","Third Stream","World Jazz"],n=Array.from(o).filter(e=>!a.includes(e)).sort();e.innerHTML="";const i=document.createElement("label");i.className="genre-checkbox-label",i.style.setProperty("--genre-color","var(--text-muted)");const s=document.createElement("input");s.type="checkbox",s.id="all-genres-checkbox",s.checked=!0,i.appendChild(s),i.append("All Genres"),e.appendChild(i),n.forEach(t=>{const o=document.createElement("label");o.className="genre-checkbox-label",o.style.setProperty("--genre-color",this.state.fullGenreColorMap[t]||"var(--genre-default)");const a=document.createElement("input");a.type="checkbox",a.value=t,a.dataset.genre=t,a.checked=!0,o.appendChild(a),o.append(t),e.appendChild(o)});const r=e.querySelectorAll('input[data-genre]');s.addEventListener("change",()=>{r.forEach(e=>{e.checked=s.checked}),this.methods.filterTimeline()}),e.addEventListener("change",e=>{e.target.matches('input[type="checkbox"]')&&("all-genres-checkbox"!==e.target.id&&(s.checked=Array.from(r).every(e=>e.checked)),this.methods.filterTimeline())}),this.methods.populateInstrumentFilter(this.state.artistsData)},renderTimeline(){const{timelineWrapper:e}=this.elements,t=[...new Set(this.state.albums.map(e=>e.year))].sort(),o=t.reduce((e,t)=>(e[t]=this.state.albums.filter(e=>e.year===t),e),{});if(e.innerHTML="",t.length>0){const a=document.createElement("div");a.style.width="1px",a.style.flexShrink="0",e.appendChild(a),t.forEach(t=>{const a=document.createElement("div");a.className="timeline-year-section",a.id=`year-${t}`;const n=document.createElement("div");n.className="timeline-year-header",n.textContent=t,a.appendChild(n);const i=document.createElement("div");i.className="timeline-album-list",i.id=`album-list-${t}`,o[t].forEach(e=>{const t=document.createElement("div");t.className="timeline-album-card fade-in-element",t.dataset.albumTitle=e.albumTitle,t.dataset.artist=e.artist,t.dataset.genres=e.genres;const o=e.genres.split(", ");let a=!1,n=null;for(const i of o){const o=this.methods.normalizeGenreName(i),s=this.state.styleMatrix.genres[o];if(s&&s.landmarkAlbums&&s.landmarkAlbums.some(t=>t.toLowerCase()===e.albumTitle.toLowerCase())){a=!0,n=s.color;break}}a&&(t.classList.add("landmark-album"),t.style.setProperty("--landmark-color",n)),t.innerHTML=`<img src="${e.cover||""}" alt="Cover for ${e.albumTitle}" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/200x200/1c1917/f5f5f4?text=No+Image';"><div class="timeline-album-card-info"><h5 class="font-bold truncate">${e.albumTitle}</h5><p class="truncate">${e.artist}</p></div>`,i.appendChild(t)}),a.appendChild(i),e.appendChild(a)}),this.methods.filterTimeline()}else e.innerHTML='<p class="text-stone-500">No timeline data available.</p>'},buildGenreMatrix(){const{matrixContainer:e}=this.elements,{styleMatrix:t}=this.state;if(t.features&&t.genres){const o=document.createElement("thead"),a=document.createElement("tr");a.innerHTML='<th class="p-4 font-bold text-2xl w-48 text-left">Genre</th>',t.features.forEach(e=>{a.innerHTML+=`<th class="p-4 font-bold text-2xl text-center">${e}</th>`}),o.appendChild(a),e.innerHTML="",e.appendChild(o);const n=document.createElement("tbody");Object.keys(t.genres).forEach(e=>{const o=t.genres[e],i=document.createElement("tr");i.innerHTML=`<th style="background-color:${o.color};">
                                <button class="genre-header-button" data-genre-name="${e}">
                                    <span>${e}</span>
                                    <svg class="info-icon w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                                </button>
                            </th>`+o.data.map(e=>`<td>${e}</td>`).join(""),n.appendChild(i)}),e.appendChild(n)}else e.parentElement.innerHTML='<p class="text-center p-4 text-stone-500">No genre data available.</p>'},setupTimelineInteraction(){const{timelineContainer:e,timelineWrapper:t,scrollLeftBtn:o,scrollRightBtn:a,stickyYearDisplay:n}=this.elements,i=400;o.addEventListener("click",()=>e.scrollBy({left:-i,behavior:"smooth"})),a.addEventListener("click",()=>e.scrollBy({left:i,behavior:"smooth"})),t.addEventListener("mouseover",e=>{if(!(window.innerWidth<768)){const o=e.target.closest(".timeline-album-card");o&&!o.classList.contains("hidden")&&!document.querySelector(".timeline-album-card.clicked")&&o.dataset.genres.split(", ")[0]!==this.state.lastHoveredGenre&&(this.state.lastHoveredGenre=o.dataset.genres.split(", ")[0],this.methods.applyHighlights(o))}}),t.addEventListener("click",e=>{const t=e.target.closest(".timeline-album-card"),o=window.innerWidth<768;if(t){if(!t.classList.contains("hidden")){const{albumTitle:e,artist:a}=t.dataset,n=this.state.visibleAlbums.findIndex(t=>t.albumTitle===e&&t.artist===a);o?this.state.mobileCardSelectedForModal===t?(-1!==n&&this.methods.openAlbumModal(this.state.visibleAlbums[n],n),this.state.mobileCardSelectedForModal=null):(this.methods.applyHighlights(t),this.state.mobileCardSelectedForModal=t):-1!==n&&this.methods.openAlbumModal(this.state.visibleAlbums[n],n)}}else o&&this.state.mobileCardSelectedForModal&&(this.methods.applyHighlights(null),this.state.mobileCardSelectedForModal=null)}),e.addEventListener("scroll",()=>{let t="";const o=[...new Set(this.state.albums.map(e=>e.year))].sort();for(const a of o){const o=document.getElementById(`year-${a}`);o&&"none"!==o.style.display&&o.offsetLeft<=e.scrollLeft+60&&(t=a)}t&&t!==this.state.lastKnownYear&&(this.state.lastKnownYear=t,n.style.opacity="0",setTimeout(()=>{n.textContent=t,n.style.opacity="1"},150)),this.methods.updateCustomScrollbar()});const s=[...new Set(this.state.albums.map(e=>e.year))].sort()[0];s&&(n.textContent=s,this.state.lastKnownYear=s)},setupModals(){const{albumModal:e,artistModal:t,genreModal:o,matrixContainer:a}=this.elements;e.querySelector("#close-modal").addEventListener("click",()=>this.methods.closeAlbumModal()),e.addEventListener("click",e=>{"album-modal"===e.target.id&&this.methods.closeAlbumModal();const t=e.target;if(t.matches('.clickable-link[data-artist-name]')){const e=t.dataset.artistName,o=this.state.artistsData.find(t=>t.name===e);o&&this.methods.closeAlbumModal(()=>this.methods.openArtistModal(o))}else if(t.matches('.clickable-link[data-genre-name]')){const e=t.dataset.genreName;this.state.styleMatrix.genres[e]&&this.methods.closeAlbumModal(()=>this.methods.openGenreModal(e))}}),document.getElementById("prev-album-btn").addEventListener("click",()=>{if(this.state.currentVisibleAlbumIndex>0){const e=this.state.currentVisibleAlbumIndex-1;this.methods.openAlbumModal(this.state.visibleAlbums[e],e)}}),document.getElementById("next-album-btn").addEventListener("click",()=>{if(this.state.currentVisibleAlbumIndex<this.state.visibleAlbums.length-1){const e=this.state.currentVisibleAlbumIndex+1;this.methods.openAlbumModal(this.state.visibleAlbums[e],e)}}),t.querySelector("#close-artist-modal").addEventListener("click",()=>this.methods.closeArtistModal()),t.addEventListener("click",e=>{"artist-modal"===e.target.id&&this.methods.closeArtistModal()}),o.querySelector("#close-genre-modal").addEventListener("click",()=>this.methods.closeGenreModal()),o.addEventListener("click",e=>{"genre-modal"===e.target.id&&this.methods.closeGenreModal()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(this.methods.closeAlbumModal(),this.methods.closeArtistModal(),this.methods.closeGenreModal())}),t.addEventListener("click",e=>{if(e.target.matches('.clickable-link[data-album-title]')){const{albumTitle:t,artist:o}=e.target.dataset,a=this.state.visibleAlbums.find(e=>e.albumTitle===t&&e.artist===o);if(a){const e=this.state.visibleAlbums.indexOf(a);this.methods.closeArtistModal(()=>this.methods.openAlbumModal(a,e))}}}),a.addEventListener("click",e=>{const t=e.target.closest(".genre-header-button");t&&this.methods.openGenreModal(t.dataset.genreName)}),o.addEventListener("click",e=>{const t=e.target.closest(".clickable-link");if(t)if(t.dataset.artistName){const e=t.dataset.artistName,o=this.state.artistsData.find(t=>t.name===e);o&&this.methods.closeGenreModal(()=>this.methods.openArtistModal(o))}else if(t.dataset.albumTitle){const{albumTitle:e,artist:o}=t.dataset,a=this.state.visibleAlbums.find(t=>t.albumTitle===e&&t.artist===o);if(a){const e=this.state.visibleAlbums.indexOf(a);this.methods.closeGenreModal(()=>this.methods.openAlbumModal(a,e))}}})},setupArtistSlider(){const{instrumentFilter:e,artistSliderTrack:t,artistPaginationControls:o,artistPageIndicator:a}=this.elements,n=e.value,i="all"===n?[...this.state.artistsData]:this.state.artistsData.filter(e=>e.instruments.includes(n));i.sort((e,t)=>e.tier!==t.tier?e.tier-t.tier:e.name.localeCompare(t.name)),t.innerHTML="";const s=window.innerWidth>=768?12:6;this.state.totalArtistPages=Math.ceil(i.length/s),this.state.totalArtistPages<=1?o.classList.add("hidden"):o.classList.remove("hidden");for(let e=0;e<this.state.totalArtistPages;e++){const o=document.createElement("div");o.className="artist-slider-page";const a=i.slice(e*s,(e+1)*s);a.forEach(e=>{const t=document.createElement("div");t.className="artist-card",1===e.tier&&t.classList.add("bandleader"),2===e.tier&&t.classList.add("influential-sideman"),t.dataset.artistName=e.name,t.innerHTML=`
                                <div class="h-56 bg-stone-900 artist-photo-container">
                                    <img src="${e.photo||""}" loading="lazy" alt="Photo of ${e.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='images/artistplaceholder.jpg';">
                                </div>
                                <div class="p-3">
                                    <h4 class="font-bold text-base text-stone-900 truncate">${e.name}</h4>
                                </div>`,o.appendChild(t)}),t.appendChild(o)}this.methods.goToArtistPage(this.state.currentArtistPage)},setupMobileMenu(){const{mobileMenuButton:e,mobileMenuOverlay:t,mobileMenuPanel:o,mobileMenuCloseButton:a,mobileNavLinks:n}=this.elements,i=()=>{t.classList.remove("hidden"),setTimeout(()=>{o.style.transform="translateX(0)"},10)},s=()=>{o.style.transform="translateX(100%)",setTimeout(()=>{t.classList.add("hidden")},300)};e.addEventListener("click",i),a.addEventListener("click",s),document.getElementById("mobile-menu-bg").addEventListener("click",s),n.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),s();const o=e.getAttribute("href"),a=document.querySelector(o);a&&setTimeout(()=>{window.scrollTo({top:a.offsetTop-80,behavior:"smooth"})},300)})})},setupScrollObservers(){const e=document.querySelectorAll(".fade-in-element"),t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is-visible"),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>t.observe(e));const o={root:null,rootMargin:"0px 0px -50% 0px",threshold:0},a=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.getAttribute("id");this.elements.navLinks.forEach(e=>{e.classList.remove("active"),e.getAttribute("href")===`#${t}`&&e.classList.add("active")}),this.elements.mobileNavLinks.forEach(e=>{e.classList.remove("text-orange-500"),e.getAttribute("href")===`#${t}`&&e.classList.add("text-orange-500")})}})},o);this.elements.sections.forEach(e=>{e.id&&a.observe(e)})},setupGeneralEventListeners(){this.elements.instrumentFilter.addEventListener("change",()=>{this.state.currentArtistPage=0,this.methods.setupArtistSlider()}),this.elements.artistSliderTrack.addEventListener("click",e=>{const t=e.target.closest(".artist-card");if(t&&t.dataset.artistName){const e=this.state.artistsData.find(e=>e.name===t.dataset.artistName);e&&this.methods.openArtistModal(e)}}),this.elements.artistPrevBtn.addEventListener("click",()=>this.methods.goToArtistPage(this.state.currentArtistPage-1)),this.elements.artistNextBtn.addEventListener("click",()=>this.methods.goToArtistPage(this.state.currentArtistPage+1));let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{const e=this.state.currentArtistPage;this.methods.setupArtistSlider(),this.methods.goToArtistPage(e),this.methods.resizeCanvas(),this.methods.updateCustomScrollbar(),this.methods.renderScrollbarMarkers()},200)}),this.elements.footerCopyright.textContent=`© ${new Date().getFullYear()} Controlled Freedom. All Rights Reserved.`,this.elements.scrollRightBtn&&this.elements.scrollRightBtn.classList.add("nudge-animation"),this.methods.setupDraggable(this.elements.timelineContainer),this.methods.setupCustomScrollbarInteraction()},slugify:e=>e?e.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""):"",normalizeGenreName:e=>"Avant-Garde Jazz"===e?"Avant-Garde":e,filterTimeline(){const e=Array.from(this.elements.genreFilterContainer.querySelectorAll('input[data-genre]:checked')).map(e=>e.value);this.state.visibleAlbums=[],document.querySelectorAll(".timeline-album-card").forEach(t=>{const o=t.dataset.genres.split(", "),a=o.some(t=>e.includes(t));t.classList.toggle("hidden",!a),a&&this.state.albums.find(e=>e.albumTitle===t.dataset.albumTitle&&e.artist===t.dataset.artist)&&this.state.visibleAlbums.push(album)}),document.querySelectorAll(".timeline-year-section").forEach(e=>{const t=e.querySelectorAll(".timeline-album-card:not(.hidden)");e.style.display=t.length>0?"flex":"none"}),this.elements.genreFilterContainer.querySelector("#all-genres-checkbox").checked=e.length===this.elements.genreFilterContainer.querySelectorAll('input[data-genre]').length,setTimeout(()=>{this.methods.resizeCanvas(),this.methods.renderScrollbarMarkers(),this.methods.updateCustomScrollbar()},0)},applyHighlights(e){document.querySelectorAll(".timeline-album-card").forEach(e=>{e.classList.remove("dimmed","highlighted"),e.style.removeProperty("--highlight-color")}),e&&(document.querySelectorAll(".timeline-album-card").forEach(e=>e.classList.add("dimmed")),Array.from(document.querySelectorAll(".timeline-album-card:not(.hidden)")).forEach(t=>{const o=e.dataset.genres.split(", ")[0],a=this.state.fullGenreColorMap[o]||"var(--accent)";t.dataset.genres.split(", ").includes(o)&&(t.classList.remove("dimmed"),t.classList.add("highlighted"),t.style.setProperty("--highlight-color",a))}))},openAlbumModal(e,t){this.state.currentVisibleAlbumIndex=t;const{albumModal:o}=this.elements;this.methods.applyHighlights(null),this.state.lastHoveredGenre=null;const a=document.querySelector(".timeline-album-card.clicked");a&&a.classList.remove("clicked");const n=e.albumTitle.replace(/"/g,'\\"'),i=e.artist.replace(/"/g,'\\"'),s=document.querySelector(`.timeline-album-card[data-album-title="${n}"][data-artist="${i}"]`);s&&s.classList.add("clicked"),o.querySelector("#modal-title").textContent=e.albumTitle;const r=o.querySelector("#modal-artist");r.textContent=e.artist,r.dataset.artistName=e.artist,r.className="text-xl text-stone-600 bg-transparent border-none p-0 clickable-link";const l=o.querySelector("#modal-album-art");l.src=e.cover||"",l.alt=`Cover for ${e.albumTitle}`,l.onerror=function(){this.onerror=null,this.src="https://placehold.co/400x400/1c1917/f5f5f4?text=No+Image"};const c=e.pivotalTracks[0]||{},d=e.genres.split(", ").map(e=>`<span class="genre-tag clickable-link" style="background-color: ${this.state.fullGenreColorMap[e]||"var(--genre-default)"}" data-genre-name="${e}">${e}</span>`).join(" "),m=c.lineup?c.lineup.split(/, (?![^()]*\))/).map(e=>{const t=e.trim().match(/(.+?)\s\((.+)\)/);return t&&this.state.artistsData.some(e=>e.name===t[1].trim())?`<span class="clickable-link" data-artist-name="${t[1].trim()}">${t[1].trim()}</span> (${t[2]})`:e}).join(", "):"N/A";o.querySelector("#modal-album-details").innerHTML=`<h4 class="text-3xl text-stone-900 mb-4">Album Details</h4><div class="grid grid-cols-[auto,1fr] gap-x-4 gap-y-2 text-base text-stone-900"><strong class="font-bold">Genre:</strong> <div class="flex flex-wrap gap-2">${d}</div><strong class="font-bold">Recorded:</strong> <span>${c.recordingDate||"N/A"}</span><strong class="font-bold">Label:</strong> <span>${c.label||"N/A"}</span><strong class="font-bold align-top">Line-Up:</strong> <span>${m}</span></div>`;const u=o.querySelector("#analysis-wrapper"),h=e.pivotalTracks.map(e=>{const t=this.methods.slugify(e.title)+".mp3";return`<div class="mb-8 last:mb-0"><div class="flex justify-between items-center gap-4 mb-4 flex-wrap"><h5 class="text-2xl font-bold text-white flex-1 min-w-0">Key Track: "<span class="underline decoration-orange-500 decoration-2 underline-offset-4">${e.title}</span>"</h5><audio controls class="styled-player w-full sm:w-52" src="songs/${t}" preload="none"></audio></div><p class="liner-notes-text">${e.analysis}</p></div>`}).join('<hr class="border-stone-700 my-8">');u.innerHTML=`<div id="modal-analysis-section">${h}</div>`;const p=u.querySelectorAll("audio");p.forEach(e=>{e.addEventListener("play",()=>{p.forEach(t=>{t!==e&&t.pause()})})}),document.getElementById("prev-album-btn").disabled=0===this.state.currentVisibleAlbumIndex,document.getElementById("next-album-btn").disabled=this.state.currentVisibleAlbumIndex>=this.state.visibleAlbums.length-1,o.classList.remove("opacity-0","pointer-events-none"),o.querySelector(".modal-content").classList.remove("scale-95"),o.querySelector("#modal-body").scrollTop=0},closeAlbumModal(e){const{albumModal:t}=this.elements;t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95"),t.querySelectorAll("audio").forEach(e=>e.pause());const o=document.querySelector(".timeline-album-card.clicked");o&&o.classList.remove("clicked"),this.methods.applyHighlights(null),this.state.lastHoveredGenre=null,"function"==typeof e&&setTimeout(e,300)},openArtistModal(e){const{artistModal:t}=this.elements;t.querySelector("#artist-modal-title").textContent=e.name;const o=t.querySelector("#artist-modal-body"),a=e.albums.map(t=>{const o=this.state.albums.find(e=>e.albumTitle===t);return o?`<li class="clickable-link" data-album-title="${o.albumTitle}" data-artist="${o.artist}">${t}</li>`:`<li>${t}</li>`}).join("");o.innerHTML=`<div class="flex flex-col sm:flex-row gap-6"><div class="w-full sm:w-1/3 flex-shrink-0 artist-photo-container"><img src="${e.photo||""}" loading="lazy" class="w-full h-auto rounded-sm border-2 border-stone-900" onerror="this.onerror=null;this.src='images/artistplaceholder.jpg';"></div><div class="w-full sm:w-2/3"><h4 class="text-3xl text-stone-900 mb-3">Details</h4><p class="mb-4 text-stone-900"><strong class="font-bold">Instruments:</strong> ${e.instruments.join(", ")}</p><h4 class="text-3xl text-stone-900 mb-3">Album Appearances</h4><ul class="list-disc list-inside text-sm space-y-1 text-stone-900 h-32 overflow-y-auto">${a}</ul></div></div>${e.profile?`<div class="mt-6 pt-4 border-t-2 border-stone-200"><h4 class="text-2xl text-stone-900 mb-2">Profile</h4><p class="text-base text-stone-700 leading-relaxed">${e.profile}</p></div>`:""}`,t.classList.remove("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.remove("scale-95")},closeArtistModal(e){const{artistModal:t}=this.elements;t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95"),"function"==typeof e&&setTimeout(e,300)},openGenreModal(e){const{genreModal:t}=this.elements,o=this.state.styleMatrix.genres[e];if(!o)return;const a=t.querySelector("#genre-modal-title");a.textContent=e,a.style.color=o.color.startsWith("var")?"var(--accent)":o.color;const n=t.querySelector("#genre-modal-body"),i=(o.landmarkAlbums||[]).map(e=>this.state.albums.find(t=>t.albumTitle.toLowerCase()===e.toLowerCase())).filter(Boolean),s=new Set(o.artists.split(", ").map(e=>e.trim()));i.forEach(e=>s.add(e.artist.trim()));const r=Array.from(s).sort().filter(e=>this.state.artistsData.some(t=>t.name===e)).map(e=>`<span class="clickable-link" data-artist-name="${e}">${e}</span>`).join(", "),l=i.map(e=>`<li><span class="clickable-link" data-album-title="${e.albumTitle}" data-artist="${e.artist}">${e.albumTitle}</span></li>`).join("");let c=`<div class="space-y-6">
                        <div>
                            <h4 class="text-2xl font-bold text-stone-900 mb-2">Overview</h4>
                            <p class="text-base text-stone-700 leading-relaxed">${o.profile||"No profile available."}</p>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold text-stone-900 mb-2">Key Characteristics</h4>
                            <ul class="list-disc list-inside space-y-1 text-stone-700">
                                <li><strong>Harmony:</strong> ${o.data[0]}</li>
                                <li><strong>Rhythm:</strong> ${o.data[1]}</li>
                                <li><strong>Form:</strong> ${o.data[2]}</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-2xl font-bold text-stone-900 mb-2">Key Artists</h4>
                            <p class="text-base text-stone-700 leading-relaxed">${r}</p>
                        </div>
                        ${i.length>0?`
                        <div>
                            <h4 class="text-2xl font-bold text-stone-900 mb-2">Landmark Albums</h4>
                            <ul class="list-disc list-inside space-y-1 landmark-album-list">${l}</ul>
                        </div>`:""}
                    </div>`;n.innerHTML=c,t.classList.remove("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.remove("scale-95")},closeGenreModal(e){const{genreModal:t}=this.elements;t.classList.add("opacity-0","pointer-events-none"),t.querySelector(".modal-content").classList.add("scale-95"),"function"==typeof e&&setTimeout(e,300)},populateInstrumentFilter(e){const{instrumentFilter:t}=this.elements,o=new Set(["alto saxophone","baritone saxophone","bass","bass clarinet","cornet","drums","flugelhorn","flute","guitar","organ","piano","soprano saxophone","tenor saxophone","trombone","trumpet","tuba","vibraphone","congas"]),a=new Set;e.forEach(e=>e.instruments.forEach(e=>{o.has(e)&&a.add(e)})),t.innerHTML='<option value="all">All Instruments</option>',Array.from(a).sort().forEach(e=>{const o=document.createElement("option");o.value=e,o.textContent=e.charAt(0).toUpperCase()+e.slice(1),t.appendChild(o)})},goToArtistPage(e){const{artistSliderTrack:t,artistPrevBtn:o,artistNextBtn:a,artistPageIndicator:n}=this.elements;this.state.currentArtistPage=Math.max(0,Math.min(e,this.state.totalArtistPages-1)),t.style.transform=`translateX(-${this.state.currentArtistPage*100}%)`,o.disabled=0===this.state.currentArtistPage,a.disabled=this.state.currentArtistPage>=this.state.totalArtistPages-1,n&& (this.state.totalArtistPages > 0 ? n.textContent = `${this.state.currentArtistPage+1} / ${this.state.totalArtistPages}`:n.textContent="")},resizeCanvas(){const{timelineCanvas:e,timelineWrapper:t}=this.elements;e.width=t.scrollWidth,e.height=t.offsetHeight},setupDraggable(e){if(!e)return;let t=!1,o,a;e.addEventListener("mousedown",n=>{t=!0,e.style.cursor="grabbing",o=n.pageX-e.offsetLeft,a=e.scrollLeft}),e.addEventListener("mouseleave",()=>{t=!1,e.style.cursor="grab"}),e.addEventListener("mouseup",()=>{t=!1,e.style.cursor="grab"}),e.addEventListener("mousemove",n=>{if(!t)return;n.preventDefault();const i=n.pageX-e.offsetLeft,s=2*(i-o);e.scrollLeft=a-s})},updateCustomScrollbar(){const{timelineContainer:e,customScrollbar:t,customScrollbarThumb:o}=this.elements;if(!e||!t||!o)return;const a=e.scrollWidth-e.clientWidth;if(a<=0)return void(t.style.display="none");t.style.display="block";const n=e.scrollLeft/a,i=e.clientWidth/e.scrollWidth;o.style.width=`${100*i}%`,o.style.left=`${n*(100-100*i)}%`},setupCustomScrollbarInteraction(){const{customScrollbar:e,customScrollbarThumb:t,timelineContainer:o}=this.elements;let a,n,i=!1;t.addEventListener("mousedown",e=>{i=!0,a=e.clientX,n=o.scrollLeft,t.style.cursor="grabbing",document.body.style.cursor="grabbing",document.body.style.userSelect="none"}),document.addEventListener("mousemove",e=>{if(!i)return;e.preventDefault();const s=e.clientX-a,r=t.clientWidth,l=o.scrollWidth-o.clientWidth;o.scrollLeft=n+s/(e.target.parentElement.clientWidth-r)*l}),document.addEventListener("mouseup",()=>{i=!1,t&&(t.style.cursor="grab"),document.body.style.cursor="",document.body.style.userSelect=""}),e.addEventListener("click",t=>{if(t.target===e){const a=e.getBoundingClientRect(),n=(t.clientX-a.left)/a.width,i=o.scrollWidth-o.clientWidth;o.scrollTo({left:n*i,behavior:"smooth"})}}),setTimeout(()=>this.methods.updateCustomScrollbar(),200)},renderScrollbarMarkers(){const{timelineContainer:e,timelineWrapper:t,customScrollbarMarkers:o}=this.elements,a=[...new Set(this.state.albums.map(e=>e.year))].sort();if(o.innerHTML="",t.scrollWidth<=e.clientWidth)return;a.forEach(e=>{const a=document.getElementById(`year-${e}`);if(a&&"none"!==a.style.display){const e=a.offsetLeft+a.offsetWidth/2,n=e/t.scrollWidth*100,i=document.createElement("div");i.className="scrollbar-marker",i.style.left=`${n}%`,i.dataset.year=`'${String(e).slice(2)}`,o.appendChild(i)}})}}};document.addEventListener("DOMContentLoaded",()=>JazzApp.init());
    </script>
</body>
</html>
