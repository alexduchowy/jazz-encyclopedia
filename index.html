<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controlled Freedom: An Interactive History of Post-Bop</title>
    
    <!-- External Libraries & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;500;700;900&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    
    <!-- Custom CSS Styling -->
    <style>
        /* Define custom color properties for easy theme management */
        :root {
            --bg-main: #f5f5f4; /* stone-100 */
            --bg-secondary: #e7e5e4; /* stone-200 */
            --bg-dark: #1a1a1a; /* Custom dark gray */
            --text-main: #1c1917; /* stone-900 */
            --text-muted: #57534e; /* stone-600 */
            --accent: #f97316; /* orange-500 */
            --accent-dark: #ea580c; /* orange-600 */

            /* Genre Colors */
            --genre-hard-bop: #d8b4fe; /* purple-300 */
            --genre-cool-jazz: #93c5fd; /* blue-300 */
            --genre-modal-jazz: #a7f3d0; /* emerald-200 */
            --genre-post-bop: #fed7aa; /* orange-200 */
            --genre-default: #e7e5e4; /* stone-200 */
        }

        /* Base body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
        }
        
        /* Heading font styling with new Bebas Neue font */
        h1, h2, h3, h4, h5 {
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.05em;
        }

        /* Crooked Header Style */
        header {
            transform: rotate(-1.5deg);
            margin-top: 1rem;
            box-shadow: 5px 5px 0px var(--text-main);
            border: 2px solid var(--text-main);
            margin-bottom: -100px; /* Pulls subsequent content up */
            position: relative; /* Needed for z-index and negative margin to work correctly */
        }
        
        /* Adjust main content to account for header overlap */
        main {
            padding-top: 100px; /* Pushes content down to create space for overlapping header */
        }

        /* Navigation link transition effects */
        .nav-link {
            transition: color 0.2s;
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 0.1em;
            font-size: 1.1rem;
        }
        .nav-link:hover, .nav-link.active {
            color: var(--accent);
        }

        /* Section header styling */
        .section-header {
             transform: rotate(-1deg);
             display: inline-block;
             background-color: var(--accent);
             color: var(--bg-main);
             padding: 0.25rem 1rem;
             margin-bottom: 1rem;
        }

        /* Timeline year marker styling */
        .year-marker {
            transition: background-color 0.2s, color 0.2s;
            border: 2px solid var(--text-main);
        }
        .year-marker.active, .year-marker:hover {
            background-color: var(--text-main);
            color: var(--bg-main);
        }

        /* Style matrix table transitions */
        .matrix-table th, .matrix-table td {
            transition: background-color 0.2s;
        }
        .matrix-table .highlight {
            background-color: var(--bg-secondary); 
        }

        /* Modal transition styles */
        .modal {
            transition: opacity 0.25s ease;
        }
        .modal-content {
            transition: transform 0.25s ease;
        }
        
        /* Horizontal draggable timeline container */
        #horizontal-timeline-container {
            width: 100%;
            overflow-x: auto;
            cursor: grab;
            border: none;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #horizontal-timeline-container::-webkit-scrollbar {
            display: none;
        }
        #horizontal-timeline-container:active {
            cursor: grabbing;
        }
        /* Wrapper for all timeline content */
        #timeline-wrapper {
            display: inline-flex;
            align-items: flex-start;
            padding: 2rem 1rem;
        }
        /* Styling for each year's section in the timeline */
        .timeline-year-section {
            display: flex;
            flex-shrink: 0;
            flex-direction: column;
            align-items: flex-start;
            border-left: 4px dotted var(--bg-secondary);
            padding: 0 2rem;
        }
        .timeline-year-section:first-child {
            border-left: none;
        }
        /* Year header styling */
        .timeline-year-header {
            font-size: 3rem; 
            font-weight: 900;
            color: var(--text-main); 
            opacity: 0.15;
            margin-bottom: 1.5rem;
            width: 100%;
            text-align: left;
        }
        /* Grid for album cards within a year */
        .timeline-album-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.5rem;
        }
        /* Individual album card styling */
        .timeline-album-card {
            width: 200px;
            flex-shrink: 0;
            background-color: var(--bg-main);
            border-radius: 0.25rem;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 4px 4px 0px var(--text-main);
            border: 2px solid var(--text-main);
            overflow: hidden;
        }
        .timeline-album-card:hover {
            transform: translateY(-5px) rotate(-2deg);
            box-shadow: 8px 8px 0px var(--accent);
        }
        .timeline-album-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            filter: grayscale(100%);
            transition: filter 0.3s ease;
        }
        .timeline-album-card:hover img {
            filter: grayscale(0%);
        }
        .timeline-album-card-info {
            padding: 0.75rem;
        }
        .timeline-album-card-info h5 {
            color: var(--text-main);
            font-size: 1.25rem;
        }
        .timeline-album-card-info p {
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
        }
        /* Artist card styling */
        .artist-card {
            background-color: var(--bg-main);
            border-radius: 0.25rem;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 4px 4px 0px var(--text-main);
            border: 2px solid var(--text-main);
        }
        .artist-card:hover {
            transform: translateY(-5px) rotate(2deg);
            box-shadow: 8px 8px 0px var(--accent) !important; /* Ensure hover always wins */
        }
        .artist-card .artist-photo-container {
             height: 224px;
             width: 100%;
        }
        .artist-card img {
             width: 100%;
             height: 100%;
             object-fit: cover;
             object-position: center;
             filter: grayscale(100%);
             transition: filter 0.3s ease;
        }
         .artist-card:hover img {
            filter: grayscale(0%);
        }
        
        #artists-slider-container {
            width: 100%;
            overflow-x: auto;
            cursor: grab;
            -ms-overflow-style: none;
            scrollbar-width: none;
            scroll-behavior: smooth;
        }
        #artists-slider-container::-webkit-scrollbar {
            display: none;
        }
        #artists-slider-container:active {
            cursor: grabbing;
        }
        #artists-slider-wrapper {
            display: flex;
        }
        .artist-page {
            width: 100%;
            flex-shrink: 0;
            padding: 1rem;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            .artist-page {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        .styled-select select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23f97316' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            background-size: 1.2em;
        }

        /* Modal Night Mode & Player Styles */
        #modal-analysis-section {
            background-color: var(--bg-dark);
            padding: 1.5rem;
            margin-top: 2rem;
            border: 2px solid var(--text-main);
            box-shadow: 4px 4px 0px var(--text-main);
        }
        #modal-analysis-section h5 {
            color: var(--bg-main);
        }
        
        .liner-notes-text {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            color: #d4d4d2; 
        }
        
        audio.styled-player {
            height: 35px; 
            accent-color: var(--accent);
        }

        /* Genre Filter Styling */
        #genre-filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .genre-checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .genre-checkbox-label input {
            appearance: none;
            -webkit-appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 0.25rem;
            margin-right: 0.5rem;
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
            border: 2px solid var(--genre-color, var(--text-main));
        }
        .genre-checkbox-label input:checked {
            background-color: var(--genre-color, var(--accent));
            border-color: var(--text-main);
        }
        .genre-checkbox-label input:checked::after {
            content: '✔';
            position: absolute;
            color: var(--text-main);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
        }

        /* Loading indicator styles */
        #loader {
            position: fixed;
            inset: 0;
            background-color: var(--bg-main);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .loader-spinner {
            border: 4px solid var(--bg-secondary);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .content-hidden {
            display: none;
        }
        
        .genre-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-main);
            border: 2px solid var(--text-main);
        }

        .hidden {
            display: none !important;
        }

    </style>
</head>
<body class="bg-stone-100 text-stone-900">

    <!-- Full-screen loader -->
    <div id="loader">
        <div class="loader-spinner"></div>
    </div>

    <div id="page-content" class="content-hidden">
        <!-- Sticky Header Navigation -->
        <header class="bg-stone-100 sticky top-0 z-50">
            <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <h1 class="text-3xl md:text-4xl font-bold text-stone-900 tracking-tight">Controlled Freedom</h1>
                    <div class="hidden sm:flex sm:items-baseline sm:space-x-8">
                        <a href="#overview" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Overview</a>
                        <a href="#timeline" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Timeline</a>
                        <a href="#matrix" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Genres</a>
                        <a href="#artists" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Artists</a>
                        <a href="#legacy" class="nav-link px-3 py-2 rounded-md font-medium text-stone-600">Legacy</a>
                    </div>
                    <div class="sm:hidden styled-select">
                        <select id="mobile-nav" class="block w-full rounded-sm border-2 border-stone-900 bg-stone-100 text-stone-900 py-2 pl-3 pr-10 focus:border-orange-500 focus:outline-none focus:ring-orange-500">
                            <option value="#overview">Overview</option>
                            <option value="#timeline">Timeline</option>
                            <option value="#matrix">Genres</option>
                            <option value="#artists">Artists</option>
                            <option value="#legacy">Legacy</option>
                        </select>
                    </div>
                </div>
            </nav>
        </header>

        <main>
            <!-- Hero Banner Section -->
            <section id="banner" class="w-full h-64 md:h-80 lg:h-96">
                <img src="images/banner.jpg" alt="Post-bop musicians in a rehearsal space" class="w-full h-full object-cover border-y-4 border-stone-900" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1511192336575-5a79af67d629?q=80&w=2074&auto=format&fit=crop';">
            </section>

            <!-- Overview Section -->
            <section id="overview" class="pt-4 pb-16 sm:pb-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl text-center">
                     <h2 class="section-header text-5xl">Post-Bop Encyclopedia</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 italic">An exploration into the era of "controlled freedom" that redefined jazz in the sixties.</p>
                    <div class="space-y-6 text-base md:text-lg leading-relaxed text-stone-900 text-left">
                        <p>The term "post-bop" is a retrospective label for a musical methodology that flourished in the late 1950s and 1960s. It wasn't a genre with rigid rules, but a shared philosophy of <strong class="text-orange-500">"controlled freedom."</strong> Musicians of this era sought a middle ground between the structured harmony of hard bop and the radical abandon of free jazz. They aimed to expand the expressive possibilities of jazz by incorporating harmonic ambiguity and rhythmic complexity without completely discarding form and melody.</p>
                        <p>This application provides an interactive journey through this pivotal decade. You can explore a year-by-year timeline of landmark albums, compare the core tenets of post-bop against its contemporary styles, and visualize the contributions of its key architects. It's a tool designed to make the dense, interconnected history of this music accessible and engaging.</p>
                    </div>
                </div>
            </section>

            <!-- Interactive Timeline Section -->
            <section id="timeline" class="py-16 sm:py-20 bg-stone-200 border-y-4 border-stone-900">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="section-header text-5xl">Timeline Explorer</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Drag or use the buttons to explore a year-by-year breakdown of landmark albums.</p>
                    <div id="genre-filter-container"></div>
                    <div class="flex items-center justify-center gap-4 mb-12">
                        <div id="timeline-nav" class="flex flex-wrap justify-center gap-2"></div>
                    </div>
                    <div class="relative group">
                        <div id="horizontal-timeline-container" class="min-h-[300px] flex">
                            <div id="timeline-wrapper"></div>
                        </div>
                        <button id="scroll-left-btn" class="absolute left-0 sm:-left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        </button>
                        <button id="scroll-right-btn" class="absolute right-0 sm:-right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Genre Comparison Matrix Section -->
            <section id="matrix" class="py-16 sm:py-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                    <h2 class="section-header text-5xl">The Genres</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Hover over the matrix to see how post-bop differed from its stylistic neighbors.</p>
                    <div class="overflow-x-auto border-2 border-stone-900 min-h-[300px]">
                        <table id="style-matrix-table" class="matrix-table w-full min-w-[800px] border-collapse text-left">
                            <!-- Table content will be generated by JavaScript -->
                        </table>
                    </div>
                </div>
            </section>

            <!-- Key Artists Slider Section -->
            <section id="artists" class="py-16 sm:py-20 bg-stone-200 border-y-4 border-stone-900">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                     <h2 class="section-header text-5xl">The Architects</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 max-w-3xl mx-auto italic">Explore the musicians who defined the post-bop era. Filter by instrument to begin.</p>
                    
                    <!-- Instrument Filter Dropdown -->
                    <div class="flex justify-center mb-8">
                        <div class="w-full max-w-xs styled-select">
                            <label for="instrument-filter" class="block text-sm font-medium text-stone-600 mb-2 text-center">Filter by Instrument:</label>
                            <select id="instrument-filter" class="block w-full rounded-sm border-2 border-stone-900 bg-stone-100 text-stone-900 py-2 pl-3 pr-10 focus:border-orange-500 focus:outline-none focus:ring-orange-500 font-bold">
                            </select>
                        </div>
                    </div>

                    <div class="relative group">
                        <div id="artists-slider-container" class="min-h-[300px] flex items-center justify-center">
                            <div id="artists-slider-wrapper">
                                <!-- Artist pages will be injected here by JavaScript -->
                            </div>
                        </div>
                        <button id="artist-scroll-left-btn" class="absolute left-0 sm:-left-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        </button>
                        <button id="artist-scroll-right-btn" class="absolute right-0 sm:-right-4 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-stone-900 text-stone-100 hover:bg-orange-500 transition-all opacity-0 group-hover:opacity-100 disabled:opacity-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Legacy Section -->
            <section id="legacy" class="py-16 sm:py-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-4xl text-center">
                    <h2 class="section-header text-5xl">Legacy</h2>
                    <p class="text-center text-lg text-stone-600 mb-12 italic">How a golden age splintered into new forms, leaving an indelible mark on music.</p>
                    <div class="space-y-6 text-base md:text-lg leading-relaxed text-stone-900 text-left">
                        <p>The golden age of acoustic innovation from 1958 to 1967 was a period of intense, shared creativity. However, by its end, the cohesive center of post-bop began to dissolve. The death of John Coltrane in 1967 removed a spiritual and musical lodestar. Simultaneously, Miles Davis began incorporating electric instruments and rock-influenced rhythms, paving the way for jazz-rock fusion with albums like *In a Silent Way* and *Bitches Brew*. This seismic shift created a new mainstream that would dominate the 1970s.</p>
                        <p>Yet, the legacy of post-bop is profound. Its harmonic, rhythmic, and compositional innovations became a permanent part of the modern jazz vocabulary. In the 1980s, the "Young Lions" movement, led by trumpeter Wynton Marsalis, sparked a "post-bop revival" that looked directly back to the acoustic, small-group aesthetic of the 1960s. This cemented the 1958-1967 period as a classic era, and its language remains the primary foundation for much of the acoustic jazz being played today.</p>
                    </div>
                     <!-- Spotify Playlist -->
                     <div class="mt-16 text-left">
                         <h3 class="text-3xl text-stone-900 mb-4">Listen now on Spotify:</h3>
                         <iframe style="border-radius:0; border: 2px solid #1c1917;" src="https://open.spotify.com/embed/playlist/6JT7jtrtYO7d5FBC3Fhh0p?utm_source=generator&theme=0" width="100%" height="500" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
                     </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="bg-stone-900 text-stone-200 py-8">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <p class="font-bold">An interactive exploration based on the "Chronological Encyclopedia of Post-Bop".</p>
                <p class="text-sm text-stone-400 mt-2">Designed to bring music history to life through interactive data visualization.</p>
            </div>
        </footer>
    </div>
    
    <!-- Modals -->
    <div id="album-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div id="modal-content" class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                <div>
                    <h3 id="modal-title" class="text-4xl text-orange-500"></h3>
                    <p id="modal-artist" class="text-xl text-stone-600"></p>
                </div>
                <button id="close-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div id="modal-album-main-details" class="flex flex-col md:flex-row gap-6">
                    <div id="modal-album-art-container" class="w-full md:w-1/3 flex-shrink-0">
                         <img id="modal-album-art" src="" class="w-full h-auto rounded-sm border-2 border-stone-900" alt="">
                    </div>
                    <div id="modal-album-details" class="w-full md:w-2/3"></div>
                </div>
                <div id="analysis-wrapper" class="relative mt-4">
                    <!-- Content injected by JS -->
                </div>
            </div>
             <!-- NEW: Modal Navigation Footer -->
            <div id="modal-nav-footer" class="flex justify-between items-center p-4 border-t-2 border-stone-900 flex-shrink-0 bg-stone-200">
                <button id="prev-album-btn" class="px-4 py-2 bg-stone-900 text-stone-100 rounded-sm font-bold hover:bg-orange-500 transition-colors disabled:bg-stone-400 disabled:cursor-not-allowed">Previous Album</button>
                <button id="next-album-btn" class="px-4 py-2 bg-stone-900 text-stone-100 rounded-sm font-bold hover:bg-orange-500 transition-colors disabled:bg-stone-400 disabled:cursor-not-allowed">Next Album</button>
            </div>
        </div>
    </div>
    <div id="artist-modal" class="modal fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="modal-content bg-stone-100 border-2 border-stone-900 rounded-sm shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
             <div class="flex justify-between items-start p-4 border-b-2 border-stone-900 flex-shrink-0">
                <h3 id="artist-modal-title" class="text-4xl text-orange-500"></h3>
                <button id="close-artist-modal" class="text-4xl font-bold p-2 leading-none text-stone-500 hover:text-orange-500">&times;</button>
            </div>
            <div id="artist-modal-body" class="p-6 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Main Application Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Fetch data, then initialize UI
            fetch('database.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    
                    const rawTrackData = JSON.parse(doc.getElementById('rawTrackData').textContent);
                    const styleMatrixData = JSON.parse(doc.getElementById('styleMatrixData').textContent);
                    
                    // Render the main content
                    initializeAppUI(rawTrackData, styleMatrixData);
                    
                    // Show the page and hide loader
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('page-content').classList.remove('content-hidden');

                    // FIX: Ensure timeline starts at the beginning after rendering
                    setTimeout(() => {
                        document.getElementById('horizontal-timeline-container').scrollLeft = 0;
                    }, 0);
                })
                .catch(error => {
                    console.error('Error fetching or parsing data:', error);
                    document.getElementById('loader').innerHTML = '<p class="text-red-500 font-bold">Failed to load data.</p>';
                });
        });

        function initializeAppUI(rawTrackData, styleMatrixData) {
            
            // ... (rest of initializeAppUI function remains the same as previous correct version)
            
            // NOTE: The rest of the JS code from the previous working version goes here.
            // This includes album processing, timeline rendering, artist section logic, modals, etc.
            // I'm omitting it here for brevity, but it should be copied from the previous version.
            const artistsData = processArtists(rawTrackData);
            const instrumentFilter = document.getElementById('instrument-filter');
            populateInstrumentFilter(artistsData);
            renderArtistSlider(artistsData);

            instrumentFilter.addEventListener('change', (e) => {
                const selectedInstrument = e.target.value;
                const filteredArtists = selectedInstrument === 'all'
                    ? artistsData
                    : artistsData.filter(artist => artist.instruments.includes(selectedInstrument));
                renderArtistSlider(filteredArtists);
            });

            // The rest of your functions (processArtists, renderArtistSlider, etc.) go here
            // ...
        }
    </script>
</body>
</html>
